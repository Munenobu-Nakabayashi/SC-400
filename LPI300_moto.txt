[001]393.3プリントサービス
以下は、smb.confからのプリンタ共有に関する部分を抜粋したものです。
（____）に入るWindowsに対してプリンタドライバをダウンロードさせるためのセクション名を選択せよ。

(        )
        path = /usr/local/samba/drivers/
        read only = no
        write list = @printadmin
        force group = @printadmin
        create mask = 0664
        directory mask = 2775

a. [print$]
b. [printers]
c. [homes]
d. [global]

正解は、「a. [print$]」です。
[print$]は、Windowsに対してプリンタドライバをダウンロードさせるためのセクションです。

この設定では、printadmin グループに所属するメンバー(ユーザ)がpathで指定されたディレクトリにプリンタドライバをアップ出来るようにします。
smb.confでは、その他に以下のセクションを使用してsmb.confで設定を行います。

[global]	：	Samba全体で使用するグローバル設定を行うセクション
[homes]	：	ユーザのホームディレクトリに関する設定を行うセクション
[printers]	：	プリンターの為の設定を行うセクション
なお、セクション名の最後に"$"が付与されている場合、ユーザに対しては非表示となります。

[002]392.4 Sambaのトラブルシューティング
Sambaのsecrets.tdbに含まれる情報をすべて選択してください。

a. Sambaユーザ情報
b. Sambaサーバやドメインの識別子情報
c. LDAPサーバの管理者パスワード
d. アカウントポリシー

正解は「b. Sambaサーバやドメインの識別子情報」と「c. LDAPサーバの管理者パスワード」です。
SambaはLinuxでWindowsのファイルやプリンターの共有を行うソフトウェアです。
LinuxのシステムがWindowsネットワークとシームレスに連携できるようになります。SambaはWindowsと互換性のあるファイル共有サービス（SMB/CIFSプロトコル）を実装し、LinuxでWindowsネットワークと統合することができます。
Sambaが提供する主な機能は以下の通りです。

ファイル共有:
Windowsクライアントからアクセスできる共有ディレクトリを提供します。Linux上のファイルをWindowsのユーザと共有することができます。

プリンター共有:
Linux上に接続されたプリンターをWindowsから利用できるようになります。

ドメインコントローラ:
Active Directory（AD）ドメインコントローラの代替として利用できます。LinuxをWindowsのドメインに参加させたり、ユーザ認証やグループ管理を行ったりすることが可能です。
Sambaはsecrets.tdbというデータベースファイルを使用して、セキュリティ情報を保持します。このファイルにはSambaサーバやドメインの識別情報（SIDなど）、LDAPサーバとの連携のための管理者パスワードが保存されます。
なおsecrets.tdbは直接編集することは推奨されません。代わりにsmbpasswdコマンドを使用して登録を行います。

a．Sambaユーザ情報
不正解です。
Sambaユーザ情報はpasswd.tdbに格納されます。

b．Sambaサーバやドメインの識別子情報
正解です。
SambaサーバやドメインのSID（識別子情報）が格納されます。

c．LDAPサーバの管理者パスワード
正解です。
LDAP連携を行う場合、LDAP管理者のパスワードをsecrets.tdbに登録します。

d．アカウントポリシー
不正解です。
パスワードの有効期限のようなアカウントポリシーはaccount_policy.tdbに格納されます。

[003]393.2 Linuxファイルシステムと共有/サービスのパーミッション
Sambaにおいて、以下の設定を行った共有ディレクトリにてファイルを作成した。作成されたファイルのパーミッションとして正しいものはどれか、選択せよ。

[share]
   path = /share
   comment = Home Directories
   browseable = yes
   writable = yes
   create mask = 0600
   force create mode = 0644
   directory mask = 0700
   force directory mode = 0755

a. 0600
b. 0644
c. 0700
d. 0755

正解は、「b. 0644」です。
設問に関連しているのは、以下の2つのパラメータです。

create mask = 0600(ファイル作成時、rw-------とする)
force create mode = 0644(create maskと各ビットをORで計算する)
計算結果は、以下のようになります。

rw- --- ---(create mask,0600)
rw- r-- r--(force create mode,0644)
------------
rw- r-- r--(ORで計算したビット)
Sambaの共有ディレクトリへ設定後、実際にファイルを作成してみると、そのようになっていることが分かります。

ubuntu@host1example1jp:/share$ ls -l
total 4
-rw-r--r-- 1 ubuntu ubuntu    0 Jan 29 19:11 testfile.txt
ディレクトリを作成する場合には directory mask(ディレクトリ作成時のパーミッション)やforce directory mode(directory maskの各ビットをORで計算する)が関連します。

[004]390.3 OpenLDAPサーバのパフォーマンスチューニング
OpenLDAPサーバを構築する際、検索速度の向上を行いたい。
チューニングの方法として誤っているものを選択してください。

a. データベースにmdbを利用する。
b. LDAP v2に対応する。
c. インデックスを作成する。
d. キャッシュサイズを調整する。

正解は「b. LDAP v2に対応する。」です。
OpenLDAPはディレクトリサービスを提供するオープンソースソフトウェアです。様々なサービスのユーザ認証やネットワーク機器の管理に利用されています。
デフォルトの設定でも利用することはできますが、チューニングを行うことで、検索速度の向上やサーバのメモリの改善が期待できます。
本項では3つの方法を紹介します。

●mdbの利用
OpenLDAPでは3種類のデータベースを利用することができます。

1. bdb(Berkeley DataBase)
OpenLDAP初期に利用されているデータベースです。
現在での利用は非推奨です。データ登録の速度は遅いかわりに検索速度は速いです。

2. hdb(Hierarchical DataBase)
bdb改良版のデータベースです。
階層型になったことにより、データ登録速度が向上しています。

3. mdb(Memory-Mapped Database)
hdb登場後に後に採用されたデータベースです。
データ登録、検索速度ともに向上しています。

●インデックスの作成
OpenLDAPのデータはツリー構造となっています。構造の数が多くなったり、階層が深くなると検索速度に影響します。特定の値で検索することがわかっている場合、必要な情報だけをまとめたインデックスを作成することで、狭い範囲で検索ができ、検索速度が向上します。

●キャッシュサイズの調整
キャッシュサイズを増やすことでデータベースへのアクセス頻度が下がり、検索速度が向上します。データ数が多いほど効果はありますが、その分メモリを使用するためサーバ全体のリソースを見て調整が必要です。

例題の各選択肢について解説をします。

a．データベースにmdbを利用する。
不正解です。
データベースをmdbをすることで検索速度は向上します。注意点として既存でhdbを利用しており、mdbに変更する場合は、データをmdbに移行する必要があります。

b．LDAP v2に対応する。
正解です。
LDAP v(バージョン)2に対応しても検索速度の向上はありません。現在のOpenLDAPは標準でv3です。v3ではv2と比べてセキュリティ機能が盛り込まれています。

c．インデックスを作成する。
不正解です。
インデックスを作成することで検索速度は向上します。

d．キャッシュサイズを調整する。
不正解です。
キャッシュサイズの調整で検索速度は向上します。

[005]396.1 NetBIOSとWINS
Sambaの名前解決を以下順序に設定したい。

a. lmhostsファイル
b. WINSサーバ
c. Linuxのシステム(hosts、DNS等)
d. ブロードキャスト
上記の順で動作するname resolve orderの設定を記載してください。

name resolve order = _____________

正解は、「lmhosts wins host bcast」です。
SambaはLinuxのファイル共有を行うソフトウェアです。Windowsとの互換性があります。ネットワーク上のクライアントをIPアドレスではなく、コンピュータ名やホスト名で通信を行うためには名前解決が必要です。
Sambaは複数の名前解決方法をサポートしており、組み合わせることができます。

パラメータはname resolve orderにて行います。
設定値は「lmhosts」 「wins」 「host」 「bcast」の4個です。
複数設定する場合はスペース区切りで指定し、左から書いたものが優先されます。

例題の各設定値について解説をします。

「lmhosts」
Sambaのlmhostsファイルで名前解決を行います。hostsと同じく各々でファイルを管理する必要があります。
書式はhostsと同様で <コンピュータ名>です。
hostsと異なる点としてコンピュータ名の後ろに#PRE等、特殊なキーワードで追加の設定をすることができます。

「wins」
wins(Windows Internet Name Service)は上記のlmhostsに代わり、主にWindows系のネットワーク環境で利用されていた名前解決方法です。
DNSサーバのようにWINSサーバでコンピュータ名と対応するIPアドレスを登録し、名前解決時にWINSサーバへ問い合わせを行います。レガシーなシステムなため現状はDNSに代わっており、使われていません。

「host」
Linuxの標準的な名前解決方法を利用します。hostという設定値から混同しやすいですが、hostsだけでなくDNSやNISによる名前解決も行います。

「bcast」
ブロードキャストで名前解決のリクエストを行います。利用するには対象のホストが同ネットワーク帯に存在している必要があります。
Sambaの名前解決順序を理解することで利用する環境にあわせた適切な方法を選択することができます。また名前解決ができない場合のトラブルシューティングに役立ちます。

[006]393.1 ファイルサービス
smbcquotasでユーザtestuserに対するクォータ(softlimit、及びhardlimit)を設定したい。
以下の______に入るものは何か。

smbcquotas -S _______:testuser:102400/200704 //127.0.0.1/sambashare

a. UQLIM
b. FSQLIM
c. FSQFLAGS
d. quota

正解は、「a. UQLIM」です。
"UQLIM"を指定した場合、指定したユーザに対するクォータ(softlimit、及びhardlimit)を設定できます。
各選択肢は、-Sオプション(ユーザーか共有の Quota の設定や変更を行う)と合わせて指定することで以下のような意味を持ちます。

a. UQLIM	：	-u で指定されたユーザーかカレントユーザー特有の Quota 制限を設定する
b. FSQLIM	：	共有のデフォルトの Quota 制限を設定する
c. FSQFLAGS	：	共有の Quota 設定を変更する
※なお、[d. quota]という設定はありません。

smbcquotasは、クォータに関する情報取得や設定をするコマンドです。
前提として、共有で使用されるファイルシステムなどでクォータが有効になっている必要があります。
-S クォータ設定	：	クォータ設定を設定・変更する
-L	：	共有に設定されているクォータ情報をリスト表示する
-F	：	共有の Quota のステータスとデフォルトの制限を表示する

[007]390.1 OpenLDAPのレプリケーション
OpenLDAPのスレーブサーバにてsyncreplによるレプリケーションの設定を行いたい。
refreshAndPersistで行う場合のリトライ設定で正しいものを選択してください。なおリトライのルールは「1分毎に3回同期、もし同期ができなかった場合は以降5分間隔で実施」とします。

a. retry="60 3 300"
b. retry="3 1 5 +"
c. retry="60 3 300 +"
d. retry="3 60 300 +"

正解は、「d. retry="3 60 300 +"」です。
OpenLDAPはディレクトリサービスを提供するオープンソースソフトウェアで、ディレクトリデータを管理するために使用します。
レプリケーションは、OpenLDAPの重要な機能の1つで、データをマスターサーバからスレーブサーバへ同期が可能です。これにより冗長性が確保でき、負荷分散を実現できます。レプリケーションは、データの可用性と信頼性を向上させ、障害時にデータの喪失を防ぐのに役立ちます。
レプリケーションにはsyncreplとreplogの2つの方式がありますが、replog方式は2.4系から廃止されたため、syncreplが主流となっています。

本例題であるレプリケーションのリトライ書式は以下の通りです。
retry="<リトライ回数> <リトライ間隔(秒)> <再リトライ間隔> <再リトライ回数>"
なお末尾の再リトライ回数が + の場合は接続が成功するまで実施します。

例題の選択肢について解説をします。

a．retry="60 3 300"
この選択肢は誤っています。
リトライ回数とリトライ間隔がルールと逆に設定されています。また再リトライ回数が設定されていません。

b．retry="3 1 5 +"
この選択肢は誤っています。
リトライ回数と再リトライ間隔の単位は秒です。

c．retry="60 3 300 +"
この選択肢は誤っています。
リトライ回数とリトライ間隔がルールと逆に設定されています。

d．retry="3 60 300 +"
この選択肢は正しいです。
レプリケーションを利用することでマスターサーバが停止してもサービスを安定して稼働させることができます。

[008]392.2 Sambaを設定する
Sambaの設定ファイルのチェックを行いたい。
smb.confの内容を解析してエラーがないか確認するコマンドは次のうちどれか選択してください。

a. smbconf
b. testparm
c. smbcontrol
d. tdbtool

正解は、「b. testparm」です。
SambaはLinuxやUNIX系OSで動作するソフトウェアで、Windowsで利用しているSMB(Server Message Block)やCIFS(Common Internet File System)などと互換性があります。
主な利用としてはファイル共有やドメインコントローラ機能があります。

本例題のtestparmコマンドは設定ファイルの構文チェックを行います。
主なオプションと書式は以下の通りです。

  testparm [-s] [-v] [smb.confのパス]
-s	：	smb.confチェック前の確認を省略します。
-v	：	デフォルト値のパラメータもすべて表示します。
smb.confのパス	：	指定しない場合、デフォルトのsmb.confをチェックします。
smb.confのパスはディストリビューションやインストール時の指定により異なる場合があります。
例題の選択肢について解説をします。

a．smbconf
この選択肢は誤っています。
smbconfというコマンドは存在しません。

b．testparm
この選択肢は正しいです。
testparmコマンドはsmb.confの構文チェックを行います。
問題がある場合はエラーを出力します。なお、あくまで構文的に正しいかどうかのため、設定した内容が期待通りに動作するかは別途確認が必要です。

c．smbcontrol
この選択肢は誤っています。
smbcontrolコマンドは起動中のsmbd、nmbd、winbinddの各デーモンにメッセージを送信するコマンドです。

d．tdbtool
この選択肢は誤っています。
tdbtoolはTDB(Trivial DataBase)の内容を表示、変更するためのコマンドです。
TDBはSamba独自のデータベースです。

testparmを利用することで設定変更前にスペルミスや書式のエラーに気づくことができます。安全な設定を行うために正しい利用方法を身に付けましょう。

[009]392.4 Sambaのトラブルシューティング
Sambaの設定(smb.conf)において、debuglevelとLog levelについて正しいものを2つ選択せよ。

a. debuglevelは、log levelの別名である
b. log levelは、デフォルト値"3"である
c. debuglevelは、log levelと併用するべきである
d. log levelは、デフォルト値"1"である

正解は、「a. debuglevelは、log levelの別名である」と「d. log levelは、デフォルト値"1"である」です。
Sambaの設定ファイルであるsmb.confでは、バージョンがパラメータ数が多く、その中には重複した役割を持っておりどちらかを使用すればよいというものがあります。
今回紹介したdebuglevelとlog levelもそんな例です。
log levelは、デフォルト値"1"となっております。数値が大きくなるについて、出力されるログ量が多くなりデバックなどトラブル解析に役に立ちますが、通常運用ではログファイルのサイズが大きくなるので注意が必要です。
その対策として、基本的には"log level 1"としながらも、一部の種類のログだけそれ以上にすることが出来るようになっています。
※設定の反映には、smb.confの再読み込みなどが必要

[010]394.2 認証と許可およびWinbind
以下のwbinfoの説明について、誤っているものを選択してください。

a. wbinfo -g は、Windowsドメインに存在するすべてのグループを一覧表示する。
b. wbinfo -u は、Windowsドメインに存在するすべてのユーザを一覧表示する。
c. wbinfo -d は、すべてのドメイン名を一覧表示する。
d. wbinfo -p は、winbindデーモンが動作中かどうかを確認する。

正解は、「3. wbinfo -d は、すべてのドメイン名を一覧表示する。」です。
winbindは、Sambaに含まれるユーティリティのひとつで、Windowsドメインと接続し、Windowsドメイン内のユーザやグループの情報をLinuxから利用できるようにします。wbinfoは、winbindから様々な情報を取得して表示するためのツールです。

主なwbinfoの利用方法を紹介します。

①Windowsドメインに存在するユーザの一覧を表示する
$ wbinfo -u

②Windowsドメインに存在するグループの一覧を表示する
$ wbinfo -g

③すべてのドメイン(信頼されたものと自分自身)を一覧表示する
$ wbinfo --all-domains

④所有するドメインだけを表示する
$ wbinfo --own-domain

⑤winbindデーモンが動作中かどうかを確認する
(winbind動作中)
$ wbinfo -p
(winbind停止中)
$ wbinfo -p

⑥ユーザ名やグループ名をSIDに変換する
$ wbinfo -n user01

⑦SIDをユーザ名やグループ名に変換する
$ wbinfo -s S-1-5-21-4203950679-1804307182-2776901580-1111

a．wbinfo -g は、Windowsドメインに存在するすべてのグループを一覧表示する。
正しい説明ですので、選択肢としては誤りです。

b．wbinfo -u は、Windowsドメインに存在するすべてのユーザを一覧表示する。
正しい説明ですので、選択肢としては誤りです。

c．wbinfo -d は、すべてのドメイン名を一覧表示する。
誤った説明ですので、選択肢としては正解です。
-d オプションは存在しません。
すべてのドメイン名を表示する場合、wbinfo --all-domains を使用します。

d．wbinfo -p は、winbindデーモンが動作中かどうかを確認する。
正しい説明ですので、選択肢としては誤りです。

[011]392.3 Sambaの保守
Sambaの設定ファイルを変更したので、smbcontrolコマンドで再読み込みさせたい。
以下の( )に入るものはどれか。

smbcontrol smbd (     )

a. reload
b. restart
c. shutdown
d. reload-config

正解は、「d. reload-config」です。
smbcontrolは、 Sambaを構成するsmbd・nmbd・winbinddのプロセスに対して指示を出す(メッセージを送信する)コマンドです。
reload-config以外には、以下のようなメッセージタイプがあります。

shutdown	：	シャットダウンさせる
debug		：	デバックレベルを設定する
stacktrace	：	デーモン(プロセス)のスタックトレースを表示する

[012]393.2 Linuxファイルシステムと共有/サービスのパーミッション
Samba経由でのファイルの削除操作を、ログに記録するための設定を選択してください。

a. full_audit:success = unlink
b. full_audit:failure = connect
c. full_audit:prefix = %T|%U|%I
d. full_audit:facility = local1

正解は、「１．full_audit:success = unlink」です。
Sambaには、vfs objects(Virtual File System Object)と呼ばれる拡張機能があります。vfs_objectsは、Sambaが提供する仮想ファイルシステムに機能を追加できます。
例えば次のような機能です。

recycle	：	削除されたファイルを保持し、リサイクルビンのように復元する機能
audit	：	特定のファイル操作をログ出力する機能
full_audit	：	全てのファイル操作ログを出力する機能
acl_xattr	：	拡張属性を使用したアクセス制御機能
今回は、この中でfull_auditを題材にしています。full_auditは、ファイル操作に関するログを柔軟に設定できるのが特徴です。例えば次のように設定を行います。

[data]
path = /data
(省略)
vfs objects = full_audit
full_audit:facility = local1
full_audit:prefix = %T|%U|%I
full_audit:success = mkdir rmdir create_file unlink rename
full_audit:failure = none
「vfs objects = full_audit」のパラメータで、full_auditの機能を有効化します。次の行の「full_audit:」のプレフィックスから始まるパラメータは、full_auditの設定項目です。

「full_audit:facility」は、ログをSyslogに出力するためのSyslogファシティです。
「full_audit:prefix」は、ログ出力時に先頭に追加されるプレフィックスです。
%Tなどのプレースホルダは、次の意味を持っています。

%T	：	操作した時間
%U	：	ユーザID
%I	：	接続元IPアドレス
次の「full_audit:success」と「full_audit:failure」は、ログに出力する操作を設定するパラメータです。
successは操作成功時、failureは操作失敗時のログを表します。設定の値には、出力対象の操作を指定します。上記の設定では、ディレクトリの作成と削除、ファイルの作成と削除、移動の成功をログ出力対象としています。失敗時はnoneを指定して、ログ出力を行っていません。

この設定の場合、次のようなログが生成されます。
2023/04/03 09:15:30|user01|192.168.100.137|data|unlink|ok|docs/file1.txt
なおSyslogに出力した場合、Syslog側で時間やプロセス情報が先頭に追加されますが、その点は省略してSambaが生成するログのみを記載しています。

このようにfull_auditの設定を活用することで、Samba経由でのファイル操作の記録を取ることができます。セキュリティレベルの向上の施策としてはもちろんのこと、ファイルの紛失時の捜索など、日常的な運用でも役にたちます。

上記でパラメータの解説をしていますが、不正解のパラメータの解説をまとめておきます。

b．full_audit:failure = connect
「full_audit:failure」は、失敗した操作を記録するためのパラメータですが、connectは接続操作であり、削除操作ではないため不正解です。

c．full_audit:prefix = %T|%U|%I
「full_audit:prefix」は、ログメッセージの先頭に特定のプレフィックスを追加するためのパラメータです。この設定は、Sambaが提供する各種情報をログに出力するためのもので、削除操作のログ記録には関係ありません。

d．full_audit:facility = local1
「full_audit:facility」は、syslogのファシリティ（ログの重要度）を指定するためのパラメータです。この設定は、ログの出力先を指定するもので、削除操作のログ記録には関係ありません。

[013]392.2 Sambaを設定する
複数のインターフェイスを持つSambaにおいて、セキュリティ向上のため待ち受けインターフェイスを制限したい。空欄に入るsmb.confのパラメータ名として適切なものはどれか。

(               ) = 192.168.111.250 127.0.0.1

a. bind interfaces only = yes
b. interfaces only
c. socket address
d. interfaces
e. browsable

正解は、「c. interfaces」です。
以下のように設定することで、interfacesで指定したインターフェイスでのみ待ち受けをします。

interfaces = 192.168.111.250 127.0.0.1
bind interfaces only = yes
interfaces：

Sambaが利用するインターフェイス(IPアドレスやインターフェイス名など)を指定する
例: interfaces = eth0 192.168.2.10/24 192.168.3.10/255.255.255.0

bind interfaces only：
yesとすることで、SMB 要求を受け付けるインタフェースを"interfaces"で指定されたものに制限する

その他選択肢は、以下の通りとなります。

socket address：
nmbdがNBTパケットの送受信に使用するアドレスを制御

browsable：
ブラウズリスト中に現れる利用可能な共有の一覧に、共有を表示させるかどうかを制御

※"interfaces only"というパラメータはありません。
browsable・browseable、socket address・nbt client socket addressのように、同じ意味を持つ別名が多く存在することがSambaの設定の特徴です。

[014]396.2 アクティブディレクトリの名前解決
Samba4をアクティブディレクトリドメインコントローラとして使用する場合、samba-tool dns コマンドでDNSの管理を行うことができます。samba-tool dns の説明について、誤っているものを選択してください。

a. samba-tool dns add は、DNSレコードを追加する。
b. samba-tool dns delete は、DNSレコードを削除する。
c. samba-tool dns zoneadd は、DNSゾーンを追加する。
d. samba-tool dns zonedelete は、DNSゾーンを削除する。

正解は、「c. samba-tool dns zoneadd は、DNSゾーンを追加する。」です。
Samba4をアクティブディレクトリドメインコントローラとして使用する場合、DNSの機能が必要となります。Samba4には内部DNSサーバの機能があり、他のソフトウェアを使用することなく、DNSサーバ機能を提供することができます。
Samba4のDNSを管理するためには、samba-tool dns コマンドを使用します。samba-tool dns コマンドを使用すれば、DNSレコードの追加や削除、DNSゾーンの追加や削除を行うことができます。

samba-tool dns の利用方法を紹介します。
●DNSゾーンを追加する際には、zonecreate サブコマンドを使用します。
$ samba-tool dns zonecreate 127.0.0.1 example.jp -U administrator

●DNSゾーンの一覧を表示する際には、zonelist サブコマンドを使用します。
$ samba-tool dns zonelist 127.0.0.1 -U administrator

●DNSレコード追加する際には、add サブコマンドを使用します。
$ samba-tool dns add 127.0.0.1 example.jp host01 A 172.16.100.1 -U administrator

●登録されているDNSレコードの確認には、query サブコマンドを使用することができます。
$ samba-tool dns query 127.0.0.1 example.jp host01 A -U administrator

a．samba-tool dns add は、DNSレコードを追加する。
正しい内容ですので、選択肢としては誤りとなります。
add サブコマンドは、DNSレコードを追加することができます。

b．samba-tool dns delete は、DNSレコードを削除する。
正しい内容ですので、選択肢としては誤りとなります。
delete サブコマンドを使用すると、登録されているDNSレコードを削除することができます。

c．samba-tool dns zoneadd は、DNSゾーンを追加する。
誤った内容ですので、選択肢としては正解です。
DNSゾーンを追加する際には、zonecrate サブコマンドを使用します。zoneadd というサブコマンドはありません。

d．samba-tool dns zonedelete は、DNSゾーンを削除する。
正しい内容ですので、選択肢としては誤りとなります。
zonedelete サブコマンドを使用すると、登録されているDNSゾーンを削除することができます。

[015]392.1 Sambaの概念とアーキテクチャ
以下のSambaデーモンのうち、ブラウジング機能の役割を担っているものはどれか。

a. smbd
b. nmbd
c. samba
d. winbindd

正解は、「b. nmbd」です。
ブラウジング機能とは、Windowsの"エクスプローラー > ネットワーク"などのファイル共有機能を持ったサーバ一覧に構築したsambaを表示させるものであり、nmbdがその役割を担っています。

nmbd以外にsambaを構成するデーモンにはsmbdとwinbinddがあり、それぞれ以下の役割を担っています。
smbd	：	ファイルやプリンタの共有、認証など
nmbd	：	ブラウジング、名前解決など
winbindd	：	NSS(ネームサービススイッチ)機能など
また、役割によって使用されるTCP/UDPのポートが異なることもSambaの特徴的なところです。
名前解決など	：	137/udp
ブラウジングなど	：	138/udp
ファイル・プリンタ共有など	：	139/tcp・445/tcp

[016]391.2 アクティブディレクトリおよびKerberosとLDAPの統合
シングルサインオンに関する説明について、誤っているものを選択してください。

a. シングルサインオンは、1度の認証で様々なシステムの認証を行うことができる
b. シングルサインオンを実現する仕組みの一つがKerberos認証である
c. シングルサインオンは、WindowsログオンとLinuxへのログインを統合するなど、OSを超えた認証はできない
d. Kerberos認証を使ったシングルサインオンはLinux系のディストリビューションでも利用できる

正解は、「c. シングルサインオンは、WindowsログオンとLinuxへのログインを統合するなど、OSを超えた認証はできない」です。
シングルサインオン（Single Sign On）は、ユーザIDとパスワードを一度認証することで、様々なシステムの認証を行えるようにする技術です。
シングルサインオンを利用することで、アプリケーションごとにユーザ名とパスワードを入力する作業の手間が軽減されるだけでなく、複数のパスワードを覚えることが不要になり、パスワード管理の負担を減らすことができます。

シングルサインオンを実現する仕組みには、以下のようなものがあります。

●Kerberos認証
クライアントのID、タイムスタンプ、有効期限が記された「チケット」を用いて認証を行います。

●SAML認証
SAMLプロトコルによる認証情報の受け渡しにより認証を行います。

●リバースプロキシ認証
全ての認証を、リバースプロキシと呼ばれる中継サーバを経由させて認証を行います。

●代理認証
クライアントPCにインストールしたエージェントに保持させたIDやパスワードを使って認証を行います。
この中でも、Kerberos認証はWindowsのActiveDirectoryに採用されている認証方式で、Linux系のディストリビューションでも利用することができます。
これにより、Kerberos認証を利用すると、WindowsログオンやLinuxへのログインと組み合わせたシングルサインオンを実現できます。つまり、Windowsにログオンすれば、他のサービスにパスワードなしでログインできるシングルサインオンを実現することができます。

例題の選択肢を確認してみましょう。

a．シングルサインオンは、1度の認証で様々なシステムの認証を行うことができる
正しい解説です。
前述の通りシングルサインオンは、1度のユーザIDとパスワードの認証により、様々なシステムの認証を行えるようにする技術です。
一般的に、アプリケーションやクラウドサービスは、個別の方法で認証を行っています。そのため、ユーザは利用するアプリケーションやサービスごとにIDとパスワードを管理する必要があります。
しかし、シングルサインオンを導入すれば、ユーザ名とパスワードの入力はシングルサインオンのシステムに一回入力するだけで、連携する他のアプリケーションやシステムへの認証を行うことができます。

b．シングルサインオンを実現する仕組みの一つがKerberos認証である
正しい解説です。
解説でも紹介した通り、シングルサインオンを実現するための仕組みには様々な種類があります。その仕組みの一つがKerberos認証です。

c．シングルサインオンは、WindowsログオンとLinuxへのログインを統合するなど、OSを超えた認証はできない
間違った解説です。
シングルサインオンを実現する仕組みによっては、Windowsだけでなく、Linux系のディストリビューションにも対応しているものがあります。
例えば、Kerberos認証を使ったシングルサインオンであれば、Linux系のディストリビューションにも対応できるため、WindowsログオンとLinuxへのログインを統合することが可能です。
今回は誤っているものを選択する問題ですので、[3]が正解となります。

d．Kerberos認証を使ったシングルサインオンはLinux系のディストリビューションでも利用できる
正しい解説です。
選択肢3でも解説した取り、Kerberos認証はLinux系のディストリビューションに対応しています。
シングルサインオンは、サービスやツールが増加した昨今において、業務効率の向上にも役立つ技術です。

[017]391.1 PAMおよびNSSとLDAPの統合
PAMやNSSとLDAPを連携させるモジュールはどれか、2つ選択せよ。

a. pam_ldap
b. ldap_pam
c. ldap_nss
d. nss_ldap

正解は、「a. pam_ldap」と「d. nss_ldap」です。
PAMはPluggable Authentication Modulesの略で、認証方式を一元的に管理する仕組みです。PAMの認証にLDAPを使用するには、pam_ldapモジュールを利用します。

[018]394.1 ユーザアカウントとグループアカウントの管理
Sambaのログインについて、以下の条件を満たすようにしたい。
●存在するユーザ名が指定された時、パスワードが正しくないとログインを拒否する。
●存在しないユーザ名が指定された時、ゲストアカウントとしてログインできる。
正しい設定を一つ選択してください。

a. map to guest = Never
b. map to guest = Bad User
c. map to guest = Bad Password
d. map to guest = Bad Uid

正解は、「b. map to guest = Bad User」です。
map to guestは、Sambaにアクセスした際、有効なユーザとして認証されなかった場合の動作を指定するパラメータです。

設定値には以下があります。

Never	：	不正なパスワードによるユーザのログイン要求を拒否し、ゲスト認証は許可しない。
Bad User	：	存在するユーザに対する不正なパスワードによるログイン要求は拒否する。存在しないユーザを指定された場合は、ゲスト認証であるとみなし、guest accountパラメータに定義されたユーザでログインする。
Bad Password	：	存在しないユーザを指定された場合に加え、存在するユーザに対する不正なパスワードによるログイン要求も、ゲスト認証であるとみなし、guest accountパラメータに定義されたユーザでログインする。
Bad Uid	：	Sambaがドメインモードのセキュリティで構成されている環境で、認証が成功したにも関わらずUNIX側のユーザアカウントが存在しない場合に、guest accountパラメータに定義されたユーザでログインする。

それでは選択肢を見ていきます。

a．map to guest = Never
不正解です。
map to guestパラメータにNeverを設定した場合、ゲスト認証はできません。

b．map to guest = Bad User
正解です。
map to guestパラメータにBad Userを設定した場合、存在しないユーザが指定された場合にのみゲスト認証を行います。

c．map to guest = Bad Password
不正解です。
map to guestパラメータにBad Passwordを設定した場合、存在しないユーザだけでなく、存在するユーザでパスワードが不正の場合もゲスト認証となります。そのため、存在するユーザがパスワードを打ち間違えた場合、エラーも表示されずゲストとしてログインすることになります。
これにより、ゲストとしてログインしていることに気づかず、アクセスできるはずのファイルにアクセスできないなどの問題が発生する場合があるので注意が必要です。

d．map to guest = Bad Uid
不正解です。
Bad Uidは、認証が成功したにも関わらずUNIX側のユーザアカウントが存在しない場合にゲスト認証する設定です。
ただし、Sambaでwinbinddが機能している場合、WindowsのユーザがUnixのユーザとして動作できるようになるため、認証に成功したにも関わらずUNIX側のユーザアカウントが存在しない、ということは発生しません。そのため、winbinddが機能するSamba3以降ではBad Uidはほとんど利用されません。
なお、Samab2.x系では、Bad Uidがデフォルトの挙動として設定されています。

[019]390.3 OpenLDAPサーバのパフォーマンスチューニング
OpenLDAPの設定において属性に値が存在するかどうかを判断するインデックスタイプはどれか、選択せよ。

a. pres
b. eq
c. sub
d. none

正解は、「a. pres」です。
各インデックスタイプは、以下のようなものになります。
pres	：	属性に値が存在するかどうかを判断するインデックスを作成
eq	：	属性と完全一致検索を行うインデックスを作成
approx	：	属性と近似検索を行うインデックスを作成
sub	：	属性に部分一致検索を行うインデックスを作成
none	：	インデックスを作成しない

設定ファイル(slapd.conf)には、以下のように記載します。
●属性cn/sn/mailに対して完全一致検索するためのインデックスを作成する例
index cn,sn,mail eq

●属性uidに対して、eq/pres/subのインデックスを作成する例
index uid eq,pres,sub

[020]392.1 Sambaの概念とアーキテクチャ
Sambaの説明で正しいものをすべて選択してください。

a. Samba4はsmbd、nmbd、winbinddの3つのプロセスから構成されている。
b. Samba3はActive Directoryの代替として機能することができる。
c. Samba3はsmbd、nmbd、winbindの3つのプロセスから構成されている。
d. Samba4はActive Directoryの代替として機能することができる。

正解は、「c. Samba3はsmbd、nmbd、winbinddの3つのプロセスから構成されている。」と「d. Samba4はActive Directoryの代替として機能することができる。」です。
Sambaのバージョン3と4では、構成するプロセスや機能が異なります。
Samba3は、例題にある通りsmbd、nmbd、winbinddの3つのプロセスから構成されています。これらのプロセスにより、Samba3では以下のような機能が提供されます。
ファイル共有
印刷サービス
名前解決
NTドメイン上のユーザー管理
ファイル共有と印刷サービスは、smbdによってWindowsクライアントに提供されます。名前解決は、NetBIOSネームサービスの要求に応答する、nmbdによって提供されます。nmbdの名前解決は、Sambaサーバーを検索するためにNetBIOS名からIPアドレスを取得するときなどに使用されます。そして、NTドメイン上のユーザー管理は、winbinddによって提供されます。Samba3では、winbinddによってWindows NTドメイン上のユーザーとグループ情報を解決し、Linuxマシン上のLinuxユーザーとして動作させることができます。

一方、Samba4はsmbd、nmbd、winbindの3つのプロセスにsambaプロセスを加えた4つのプロセスから構成されています。Samba4で追加されたsambaプロセスによって、DNSサーバーとLDAPサーバーの機能を包括し、Active Directory（以下AD）の代替として機能できるようなりました。
そのため、Samba4では以下の機能が提供されます。
ファイル共有
印刷サービス
名前解決
AD互換のドメインコントローラー
さらにSamba4では、ADドメイン内におけるコンピューターの使用環境を制限することのできる「グループポリシー」という機能や、Windowsに備わっているGUIのリモートサーバー管理ツール(RSAT)が利用できるようになりました。

それでは選択肢を見ていきます。
a．Samba4はsmbd、nmbd、winbinddの3つのプロセスから構成されている。
不正解です。
Samba4はsmbd、nmbd、winbindとsambaプロセスの4つのプロセスから構成されています。

b．Samba3はActive Directoryの代替として機能することができる。
不正解です。
Active Directoryの代替として機能することができるのは、Samba4からです。
Samba3では、ADの代替として機能はできません。

c．Samba3はsmbd、nmbd、winbindの3つのプロセスから構成されている。
正解です。

d．Samba4はActive Directoryの代替として機能することができる。
正解です。

現在、Sambaのメジャーバージョンは4ですが、Samba3の機能を引き継いでいる部分も多くあります。

[021]390.2 ディレクトリの保護
OpenLDAPの非認証バインドについて正しい説明はどれか。

a. ユーザ名・パスワードが要求される認証方式
b. 名前もパスワードも要求されない認証方式
c. ユーザ名のみ要求される認証方式
d. パスワードのみ要求される認証方式

正解は、「c. ユーザ名のみ要求される認証方式」です。
DAPの簡易認証では、以下の3つのモードがあります。
●匿名バインド	：	名前もパスワードも要求されない認証方式
●非認証バインド	：	ユーザ名のみ要求される認証方式
●ユーザ名／パスワード認証方式	：	ユーザ名・パスワードが要求される認証方式

それぞれ無効化や使用可能にする場合は、以下のように設定を行います。
●匿名バインドを無効化する場合、slapd.confで"disallow bind_anon"を指定する
●非認証バインドはデフォルトでは使用不可になっており、slapd.confに"allow bind_anon_cred"を指定することで使用可能となる
●ユーザー/パスワード認証バインドを無効にする場合、slapd.confに"disallow bind_simple"を設定する
その他、OpenLDAPではSASL(Simple Authentication and Security Layer)を使った認証も可能です。

[022]393.2 Linuxファイルシステムと共有/サービスのパーミッション
smb.confに以下の設定を行い、sambaを経由してshareディレクトリ配下にファイルの作成を行った。
[share]
        path = /share
        public = yes
        writable =yes
        create mask = 0760
        force create mode = 0644
この時、Sambaによって作成されたファイルのパーミッションとして正しいものを一つ選択してください。

a. -rwxrw----
b. -rw-r--r--
c. -rwxr-xr-x
d. -rwxrw-r--

正解は、「d. -rwxrw-r--」です。
例題のsmb.confの設定から解説します。
[share]
        path = /share
        public = yes
        writable =yes
        create mask = 0760
        force create mode = 0644
各設定の意味は以下の通りです。
path = /share	：	共有するディレクトリとして、/shareディレクトリを設定しています。
public = yes	：	ユーザ問わずフォルダを公開します。
writable =yes	：	共有フォルダへの書き込みアクセスを許可しています。
create mask = 0760	：	ファイル作成時に付与するアクセス権を指定しています。
force create mode = 0644	：	ファイル作成時に必ず付与されるアクセス権を指定しています。
今回の例題を解くためにポイントとなるのは、アクセス権に関連する「create mask」と「force create mode」の2つのパラメータです。

「create mask」と「force create mode」はどちらもファイルのアクセス権を制御するパラメータで、2つのパラメータの値はOR演算が行われます。
今回例題では、「create mask = 0760」「force create mode = 0644」が設定されているため、ファイル作成時に設定されるアクセス権は、「0760」OR「0644」の演算が行われ、「0764」のアクセス権が適用されます。

[023]390.1 OpenLDAPのレプリケーション
以下のうち、OpenLDAPのレプリケーションに関して正しいものを選択せよ。

a. refreshAndPersistを設定した場合、OpenLDAPはLDAPクライアントとの間で永続的な接続を維持しようとする。
b. プロバイダのsyncreplディレクティブで、接続するコンシューマーを指定する。
c. プロバイダとコンシューマーによるレプリケーションは、PULL型である。
d. コンシューマーの保持するデータが、プロバイダに複製される。

正解は、「c. プロバイダとコンシューマーによるレプリケーションは、PULL型である。」です。
OpenLDAPにおいて、保持するデータを他のサーバへ複製することをレプリケーションと呼びます。PULL型のレプリケーションでは、オリジナルデータを持つプロバイダとそのデータの複製を持つコンシューマーでレプリケーションを行います。

コンシューマー側のsyncreplディレクティブにプロバイダ情報を記載し、データを取得するように設定します。また、データの更新の仕方には"refreshOnly"と"refreshAndPersist"があり、それぞれ以下のような動作をします。
●refreshOnly：
コンシューマーが定期的にプロバイダとセッションを張り、データ同期する動作

●refreshAndPersist：
コンシューマーはプロバイダとセッションを張り続け、リアルタイムにデータ同期する動作

[024]392.3 Sambaの保守
Sambaサーバに対するuser01のアクセス状況のみを出力するコマンドを１つ選択してください。

a. smbstatus -b user01
b. smbstatus -d user01
c. smbstatus -u user01
d. smbstatus -S user01

正解は、「c. smbstatus -u user01」です。
smbstatusコマンドは、Sambaサーバに対するアクセス状況を調べるコマンドです。
smbstatusコマンドの基本的な書式は以下になります。
●smbstatus オプション

smbstatus オプション 
代表的なオプションは以下になります。

オプション		概要
-b	：	簡単な情報を表示する
-d	：	詳細な情報を表示する
-u	：	「-u 」で特定のユーザ情報を表示する
-L	：	ロックされたファイルの一覧表示
-S	：	接続の一覧表示

a. smbstatus -b user01
不正解です。
-bオプションは、簡単な情報を表示するコマンドです。

b. smbstatus -d user01
不正解です。
-dオプションは、詳細なアクセス状況を調べるコマンドです。

c. smbstatus -u user01
正解です。
-uオプションは、「-u 」で特定のユーザ情報を表示します。

d. smbstatus -S user01
不正解です。
-Sオプションは、接続の一覧表示を行います。

[025]394.1 ユーザアカウントとグループアカウントの管理
smb.confのforce user/force group設定について、正しいものを選択せよ。

a. 該当ユーザアカウントでのアクセスを拒否する
b. 指定されたユーザやグループの作成が出来なくなる
c. 指定されたユーザやグループの権限で操作を実行する
d. 該当グループアカウントでのアクセスを許可する

正解は、「c. 指定されたユーザやアカウントの権限で操作を実行する」です。
sambaでは多くの設定パラメータがあり、smb.confでその設定を行います。
セキュアな環境構築のためには、適切なユーザアカウント・グループアカウント管理が求められ、Sambaの設定パラメータを理解しておく必要があります。
force user/force groupは、指定されたアカウント権限でファイルの操作を実行します。

[026]390.1 OpenLDAPのレプリケーション
OpenLDAPのレプリケーションについて、適切でない説明を1つ選択してください。

a. syncreplでは、プロバイダが管理するエントリのうち、条件を満たす属性だけを指定してコンシューマに同期できる。
b. OpenLDAP 2.4ではマルチマスタレプリケーションが実現できる。
c. syncreplでは、同期状態をcookieで管理している。
d. syncreplでは、プロバイダ側で存在しなくなったエントリをコンシューマ側で削除してから変更エントリの複製を行う。

正解は、「d. syncreplでは、プロバイダ側で存在しなくなったエントリをコンシューマ側で削除してから変更エントリの複製を行う。」です。
Openldapは２つのレプリケーション方法があります。

●slurpdによるレプリケーション
複製元をマスターサーバ、複製先をスレーブサーバと呼びます。
マスターサーバで行われた更新の情報をファイルに書き出し、これをslurpdが定期的にチェックして、スレーブサーバ側に反映します。
（OpenLDAP 2.4以降はsyncreplに置き換えられて、slurpdは利用できません）

●syncreplによるレプリケーション
複製元をプロバイダ、複製先をコンシューマ呼びます。
syncreplではコンシューマがプロバイダに接続して複製を行います。

コンシューマがプロバイダのディレクトリを参照して、コンシューマ側で必要な更新処理を決めるため、プロバイダとコンシューマが持つ情報が異なっていた場合でも適切な複製が行われます。
syncreplは同期処理用のcookieを管理・交換することで、複製内容の状態を管理します。
OpenLDAPはもともとslurpdにてレプリケーションを行っていましたが、マスター/スレーブ間で正しく同期し続けることを保証するのが難しいことと、管理が複雑になる問題がありました。その問題を解消するために、syncreplと呼ばれるレプリケーション方法が導入されました。

選択肢の解説は以下です。
a.  syncreplでは、プロバイダが管理するエントリのうち、条件を満たす属性だけを指定してコンシューマに同期できる。
正しい説明をしているため、不正解です。
コンシューマ側のslpad.conf内に、「attrs=」に値を指定することで、条件を満たす属性だけ指定した、同期が可能です。
カンマで区切って複数指定することも可能です。

b. OpneLDAP 2.4ではマルチマスタレプリケーションが実現できる。
syncreplはマルチマスタレプリケーションに対応しており、正しい説明をしているため、不正解です。

c. syncreplでは、同期状態をcookieで管理している。
正しい説明をしているため、不正解です。

d. syncreplでは、プロバイダ側で存在しなくなったエントリをコンシューマ側で削除してから変更エントリの複製を行う。
誤った解説をしているため、正解です。
syncreplではコンシューマ側で削除しなくても変更エントリの複製を行うことができます。

[027]392.2 Sambaを設定する
Sambaにてユーザレベルのセキュリティを利用する設定を行います。
smb.confの中に記載する[global]セクション内に設定する内容として正しいものを選択してください。

a. security = local
b. security = domain
c. security = user
d. security = public

正解は、「c. security = user」です。
[global]セクション内のsecurityはユーザ認証方法を決定するパラメータです。
Sambaを利用してファイルを共有する際に、ユーザ認証方法は最も重要な設定の一つで十分に考慮して設定値を決定する必要があります。

設定可能な値と説明は以下の通りです。
●user
ユーザレベルのセキュリティを利用する設定です。
接続時にクライアントはユーザ名とパスワードの組み合わせをサーバに送ります。この設定を利用する場合は、encrypt passwordパラメータによる暗号化パスワードが利用可能です。
map to guestパラメータを利用すると、パスワードなしの共有が可能です。

●auto
server roleのパラメータが設定されていると、自動的にセキュリティ・モードを決定します。
server roleはSambaサーバの基本的な動作モードを決定するパラメータです。
server roleの設定値は以下の通りです。
-standalone
　ユーザ名とパスワードを利用してログインを行うモードです。
　security = userとして動作します。
-member server
　WindowsのドメインにSambaを参加させるモードです。
　security = domainとして動作します。
-domain controller
　SambaをWindowsドメインコントローラーとして起動するモードです。
　security = adsとして動作します。

●domain
Windowsドメインコントローラでユーザ認証を行う場合に設定します。
この設定を利用する場合は、netコマンドでドメイン参加しておく必要があります。Windows Serverのドメインコントローラによる認証を行う他は、userを設定した時と同じです。

●ads
SambaをActiveDirectoryのドメインメンバとして動作させます。ただし、Sambaが起動しているホスト上でKerberosが設定されている必要があり、netコマンドを用いてADSにつながっていることが必要です。これはSambaをActiveDirectoryドメインコントローラとして動かすことではありませんので注意が必要です。

選択肢の解説は以下です。

「a. security = local」
「security = local」は設定可能な値に存在しないため、不正解です。

「b. security = domain」
「security = domain」はWindowsドメインコントローラでユーザ認証を行う場合に設定するため、不正解です。

「c. security = user」
「security = user」はユーザレベルのセキュリティを利用する設定のため、正解です。

「d. security = public」
「security = public」は設定可能な値に存在しないため、不正解です。

[028]392.2 Sambaを設定する
日本語の環境でSambaを利用するときに、smb.confで設定すべきパラメータとして適切なものを２つ選びなさい。

a. charset
b. dos charset
c. unix charset
d. lang

正解は、「b. dos charset」と「3. unix charset」です。
日本語を利用する環境ではsmb.confでSambaの文字コードに関する設定が必要です。Sambaサーバとクライアントで文字コードが異なっている環境でも正しく扱えるようにするため、下記2つのパラメータの設定が必要です。利用する環境に合わせて設定を行いましょう。
「dos charset」パラメータでは、クライアント側で用いられる文字コードを指定します。
「unix charset」パラメータでは、Sambaサーバ側で用いる文字コードを指定します。サーバ側で管理するファイル名などはこの文字コードで管理されます。
「dos charset」や「unix charset」を正しく設定しないと、日本語のファイル名等が文字化けすることがあります。

選択肢の解説は以下です。
「a. charset」
誤りです。
smb.confには「charset」のパラメータは存在しません。

「b. dos charset」
正解です。
このオプションにより、Sambaがクライアントと通信する際に用いられる文字コードを指定します。
デフォルトは Samba にインストールされた文字コードセットによって異なります。

「c. unix charset」
正解です。
このオプションにより、Sambaが動作するサーバで使われている文字コードを指定します。ここで設定した文字コードは、Samba から実行するスクリプトの引数にも使用されます。

「d. lang」
誤りです。
smb.confには「lang」のパラメータは存在しません。

[029]394.1 ユーザアカウントとグループアカウントの管理
ADドメインにおいて、ユーザjoeのパスワード有効期限を90日に設定するためのコマンドとして、正しいものはどれか。

a. samba-tool user expire joe --days=90
b. samba-tool user enable joe --days=90
c. samba-tool user setexpire joe --days=90
d. samba-tool user add joe --days=90

正解は、「c. samba-tool user setexpire joe --days=90」です。
ADドメイン管理は、基本的にはWindowsクライアントで実行が可能な"Active Directoryユーザーとコンピュータ"や"RSAT(Windows用リモートサーバ管理用ツール)"などで実施しますが、DC(Domain Controller)の追加やユーザー・グループ管理などsamba上でsamba-toolを使って実施できるものがあります。

ユーザー管理には、samba-tool userコマンドを使用し、以下のサブコマンドなどが利用できます。
●samba-tool user create：
　ADドメインに新規ユーザを作成

●samba-tool user delete：
　存在するユーザーアカウントを削除

●samta-tool user disable：
　ユーザーアカウントを無効化

●samba-tool user enable：
　ユーザーアカウントを有効化

●samba-tool user list：
　ユーザー一覧表示

●samba-tool user setexpiry：
　ユーザーアカウントの満了日を設定

また、グループ管理には、samba-tool groupコマンドを使用し、以下のサブコマンドなどが利用できます。
●samba-tool group add：
　新しいADグループを作成

●samba-tool group delete：
　ADグループを削除

●samba-tool group list：
　ADグループ一覧表示

●samba-tool group addmembers：
　ADグループにメンバーを追加

●samba-tool group removemenbers：
　ADグループからメンバーを削除

●samba-tool group listmembers：
　ADグループのメンバー一覧表示

samba-toolにはその他に、グループポリシーオブジェクト(GPO)を管理するsamba-tool gpo・ドメインを管理するsamba-tool domain・DNSを管理するsamba-tool dnsなどがあります。

[030]397.2 Windowsクライアントの操作
Linuxサーバ(10.1.3.53)で共有されているリソースを、Windowsクライアントのコマンドプロンプトで確認するためのコマンドで正しいものを1つ選択してください。

a. net view \10.1.3.53
b. net share \10.1.3.53
c. net use \10.1.3.53
d. net file \10.1.3.53

正解は、「1. net view \10.1.3.53」です。
Windowsのnetコマンドは、ネットワークなどの状態を調査したり、設定を変更したりすることのできるコマンドです。Linuxサーバのファイルサービスやプリントサービスにアクセスできない場合など、Windowsネットワークのトラブルシューティングを行う場合、netコマンドを使うことで問題の切り分けを行うことができます。

ファイルやプリンタ、共有サービスに関連する主なサブコマンドは以下の通りです。
●net share ：
ローカルリソースの公開や、公開した共有リソースの確認、変更、公開削除を行うためのコマンド。

●net use ：
共有リソースとして公開されているネットワークドライブの確認や、共有リソースをローカルで使用するためのドライブへのマッピングの作成、削除を行うためのコマンド。

●net view ：
特定のコンピューターが公開している共有リソースの一覧を調べるためのコマンド。

●net file ：
公開したローカルリソースのうち、外部のコンピューターで使用されているファイルの一覧の表示、強制終了を行うためのコマンド。

●net session ：
ローカルの共有リソースにアクセスしているクライアントの一覧表示や強制終了を行うためのコマンド。

●net print ：
共有プリンタの情報や印刷キューの情報の表示や設定を行うためのコマンド。

それでは、選択肢を見ていきます。

a．net view \10.1.3.53
正解です。
net viewコマンドは引数にコンピューター名を指定することで、指定したコンピューターで共有されているリソースを一覧で確認することができます。

b．net share \10.1.3.53
誤りです。
net shareコマンドは、ローカルリソースを公開したり公開を解除するためのコマンドです。引数には共有名を指定するか、引数なしで実行する必要があります。

c．net use \10.1.3.53
誤りです。
net useコマンドは、共有リソースとして公開されているネットワークドライブの確認や、共有リソースをローカルで使用するためのドライブへのマッピングの作成、削除を行うためのコマンドです。

d．net file \10.1.3.53
誤りです。
net fileコマンドは、公開したローカルリソースのうち、外部のコンピューターで使用されているファイルの一覧の表示、強制終了を行うためのコマンドです。
引数にはファイルIDを指定するか、引数なしで実行する必要があります。

[031]392.3 Sambaの保守
tdbファイルに破損したデータがないか確認したい。使用するコマンドとオプションの組み合わせから正しいもの1つ選択せよ。

a. smbcontrol -V
b. smbstatus -p
c. tdbbackup -h
d. tdbbackup -v

正解は、「d. tdbbackup -v」です。
tdbbackupコマンドは、Sambaの.tdbファイルのバックアップや整合性の確認を行うツールです。
それ以外の選択肢の意味は、以下となります。
smbcontrol -V	：	smbcontrolのバージョン表示
smbstatus -p	：	smbdプロセスの一覧表示
tdbbackup -h	：	tdbbackupのヘルプ表示

[032]OpenLDAPのslapd.confファイルにインデックスを設定したい。
uidNumber属性を持つすべてのエントリの検索を効率的に行うためのインデックスの指定方法として正しいものを選択してください。

a. index uidNumber pres
b. index uidNumber sub
c. index uidNumber eq
d. index uidNumber approx

正解は、「a. index uidNumber pres」です。
OpenLDAPでは、インデックスを作成することでデータ検索を高速化することができます。インデックス設定として指定できる種類は以下の通りです。
pres	：	値の存在を検索するインデックスを作成
sub	：	値と部分一致するエントリを検索するインデックスを作成
eq	：	値と完全一致するエントリを検索するインデックスを作成
approx	：	近似値を検索するインデックスを作成
OpenLDAPでインデックスを作成するには、2つの方法があります。

●LDIF形式で設定
●slapd.confに設定
例題のように、slapd.confファイルでインデックス設定をした場合、slapindexコマンドを用いてインデックスを作成する必要があります。

それでは、選択肢を見ていきます。
a．index uidNumber pres
正解です。
「pres」を指定した場合、「uidNumber=*」のように属性を持つすべてのエントリを検索するインデックスを作成することができます。

b．index uidNumber sub
誤りです。
「sub」を指定した場合、属性の値が部分一致するエントリを検索するインデックスを作成します。

c．index uidNumber eq
誤りです。
「eq」を指定した場合、属性の値が完全一致するエントリを検索するインデックスを作成します。

d．index uidNumber approx
誤りです。
「approx」を指定した場合、属性の値に近似マッチするエントリを検索するインデックスを作成します。

[033]393.1 ファイルサービス
Samba共有へアクセスした際、共有フォルダが表示されない。原因として考えられるものはどれか。

a. browseable = noとなっている
b. smbdが停止している
c. read only = noが未設定である
d. nmbdが停止している

正解は、「1.browseable = noとなっている」です。
browseableは、Sambaへアクセスした際の共有フォルダ表示/非表示を設定するパラメータです。yesで表示、noで非表示となります。

Sambaでは、smbd/nmbdの2つのデーモン(サービス)により共有を実現します。それぞれの役割は、以下となります。
●smbd：	ファイル共有機能などを提供するデーモン
●nmbd：	NetBIOSネットワークにおける名前解決機能を提供するデーモン
つまり、smbdやnmbdが停止していた場合、ファイル共有機能自体が利用できない、名前解決機能が利用できないとなるため、正解ではありません。
また、read onlyは共有フォルダを読み取り専用とするかどうかであり、正解ではありません。
なお、browseableと同じ意味のbrowsableというパラメータもあります。このようにSambaの設定(smb.conf)では同じ機能を実現するためのパラメータが複数存在したり共有の細かな設定を行うことが出来ますが、使いこなすにはパラメータの全体を把握し適切に設定する必要があります。

[034]392.3 Sambaの保守
現在Sambaに接続しているホストの一覧を表示するコマンドで正しいものを1つ選択してください。

a. smbcontrol all staus
b. smbstatus -S
c. smbcontrol all reload-config
d. smbstatus -L

正解は、「b. smbstatus -S」です。
smbstatusコマンドは現在Sambaに接続しているコネクション情報やロック状態を表示するコマンドです。
出力に関するオプションには以下のようなものがあります。

-b|--brief	：簡単な出力を表示
-u|--user=<username>	：指定されたユーザーに関する情報のみを表示
-L|--locks	：ロックされたファイルの一覧を表示
-S|--shares	：接続の一覧を表示
-p|--processes	：プロセス一覧を表示
それでは、選択肢を見ていきます。

a. smbcontrol all staus
誤りです。
smbcontrolコマンドは起動中のsmbd、nmbd、winbinddの各デーモンにメッセージを送信するコマンドです。
書式は以下の通りです。
$smbcontrol [destination] [message-type] [parameters]
[destination]には、smbd、nmbd、winbinddの各デーモン名か、プロセスIDを指定します。動いているデーモン全てにメッセージを送りたい場合は、allを指定することもできます。
[destination]に指定したプロセスに対し、[message-type]に指定したメッセージの操作することができます。[message-type]には以下のようなものがあります。
・close-share	：smbdに対し、指名した共有に接続しているクライアントの接続を閉じるように命令する
・ping			：[parameter]で指定された数だけの"ping"メッセージを送信し、同じ数だけの"ping"メッセージの応答を待つ
・shutdown		：指定されたデーモンを落とすことができる
・reload-config	：デーモンにsmb.conf設定ファイルの再読み込みを強制させる
なお、選択肢にあるstausという[message-type]はありません。

b. smbstatus -S
正解です。
smbstatusコマンドに-Sオプションをつけることで、現在Sambaに接続しているホストの一覧を表示することができます。

c. smbcontrol all reload-config
誤りです。
[message-type]にreload-configを指定した場合、smb.conf設定ファイルの再読み込みを行います。
この選択肢の場合、[destination]にallを指定しているため、nmbdとwinbindを含む、動いているデーモンすべてにsmb.conf設定ファイルの再読み込みを強制させます。

d. smbstatus -L
誤りです。
smbstatusコマンドに-Lオプションを指定した場合、ロックされたファイルの一覧が表示されます。
稼働中のSambaにどのホストが接続しているのかなど、Sambaの接続状況を確認することは保守を行う際に必須です。

[035]392.4 Sambaのトラブルシューティング
SambaのデータベースであるTDBファイルの整合性を確認するコマンドを2つ選択してください。

a. tdbdump -e TDBファイル名
b. tdbtools TDBファイル名 check
c. tdbbackup -v TDBファイル名
d. tdbdump --check TDBファイル名

正解は、「b」と「c」です。
Sambaでは、動作中の設定情報を格納するために軽量なデータベースTrivial Database(tdb)を利用しています。
TDBはkey-value型のデータベース構造となっており、非常にシンプルに値を保持しているため、格納するデータの種類によってTDBファイルが用意されます。

それでは、選択肢を見ていきます。

a．tdbdump -e TDBファイル名
誤りです。
tdbdumpコマンドは、TDBファイルの中身を人が読めるフォーマットでダンプするコマンドです。
なお、[-e]オプションは、破損したデータベースからダンプを試みるためのオプションです。

b．tdbtools TDBファイル名 check
正解です。
tdbtoolsコマンドはTDBファイルの内容を表示したり変更したりするコマンドです。checkサブコマンドを使用することで、データベースの整合性を検査することができます。

c．tdbbackup -v TDBファイル名
正解です。
tdbbackupコマンドは、.tdb ファイルのバックアップを行うコマンドです。
引数にバックアップするTDBファイルを指定することで、バックアップファイルを作成することができます。
また、[-v]オプションを利用することで、データベースに破損したデータがないか整合性を検査し、もし問題があった場合は以下のようにバックアップからTDBの復元も行います。

４．tdbdump --check TDBファイル名
誤りです。
tdbdumpは選択肢aで解説した通り、TDBファイルの中身をダンプするコマンドです。
なお、--checkというオプションはありません。

[036]390.2 ディレクトリの保護
以下のうち、SASLオプションであるセキュリティ強度係数(SSF)のうち、最も強度の高いものはどれか。

a. 0
b. 1
c. 56
d. 112
e. 128

正解は、「e. 128」です。
セキュリティ強度係数(SSF)はslapd.conf/ldap.confで設定するSASLオプションであり、クライアント・サーバ間のLDAP通信の際に使用されます。

セキュリティ強度係数では、以下の値が設定できます。
0	：保護なし
1	：整合性の保護のみ
56	：DES、もしくは他の弱い暗号化方式を有効化
112	：3DES、もしくは他の強い暗号化方式を有効化
128	：RC4/Blowfish、もしくは他の現代的な強い暗号化方式を有効化
minssf、およびmaxssfというパラメータで上記値を設定します。

[037]393.3 プリントサービス
CUPSを利用した印刷システムをSambaにて設定をしたい。　
空欄に入るsmb.confのパラメータ名はどれか。

 [global]
 (          ) = cups

a. printer
b. printing
c. print
d. printable

正解は、「b. printing」です。
CUPS(Common Unix Printing System)とはUNIX系OSにおける印刷システムであり、WindowsやMacOS向けのプリンタをLinuxを含むUNIX系OSで利用可能にするなどの機能を持っています。

CUPSをSambaと連携させて使用する場合、Sambaの設定ファイルであるsmb.confの[global]セクションにおいて以下のように設定します。
[global]
load printers = yes
printing = cups
printcap name = cups
smb.confでは印刷に関連したものとして、[printers]セクションで利用するプリンタに関する設定、[print$]セクションでプリンタドライバの自動ダウンロード設定などを行います。

[038]390.1 OpenLDAPのレプリケーション
LDAPサーバのマスタ/スレーブレプリケーション構成について、正しい説明を選択してください。

a. マスターサーバだけがLDAP参照・更新を行うことができる。
b. スレーブサーバだけがLDAP参照・更新を行うことができる。
c. マスタサーバとスレーブサーバの両方がLDAP参照・更新を行うことができる。
d. マスタサーバとスレーブサーバの両方がLDAP参照を行うことができ、マスタサーバだけがLDAP更新を行うことができる。

正解は、「4. マスタサーバとスレーブサーバの両方がLDAP参照を行うことができ、マスタサーバだけがLDAP更新を行うことができる。」です。
LDAPサーバは、ひとつのLDAPサーバに行われた更新を他のLDAPサーバにも同期するレプリケーションを構成することができます。
LDAPレプリケーションの機能を使用すれば、LDAPデータの冗長化、LDAPサービスの負荷分散等を行うことができます。

LDAPのレプリケーションには下記の構成があります。

●マスタ/スレーブ構成
マスタサーバだけが更新の要求を受け付けます。
マスタサーバが更新要求を受け付けると、その更新内容をスレーブサーバにも反映する方法でプリケーションを行います。
スレーブサーバは参照要求に応えることはできますが、更新要求に応えることはできません。
スレーブサーバを複数台配置することで、参照用LDAPサーバの負荷分散を実現することができます。

●マルチマスタ構成
複数のマスタサーバを配置する構成です。
マスタサーバが更新要求を受け付けると、その更新内容を別のマスタサーバにも反映する方法でレプリケーションを行います。
複数のマスタサーバがお互いに更新内容を同期します。

例題の選択肢について解説します。

a. マスタサーバだけがLDAP参照・更新を行うことができる。
誤った説明です。
LDAP参照は、マスタサーバとスレーブサーバの両方とも行うことができます。

b. スレーブサーバだけがLDAP参照・更新を行うことができる。
誤った説明です。
LDAP更新は、スレーブサーバは行うことができません。

c. マスタサーバとスレーブサーバの両方がLDAP参照・更新を行うことができる。
誤った説明です。
LDAP参照は、マスタサーバとスレーブサーバの両方が行うことができますが、LDAP更新はマスタサーバだけしか行うことができません。

d. マスタサーバとスレーブサーバの両方がLDAP参照を行うことができ、マスタサーバだけがLDAP更新を行うことができる。
正しい説明です。

[039]396.1 NetBIOSとWINS
以下のうち、NetBIOSとWINSに関して正しいものを2つ選択せよ。

a. ローカルマスタブラウザは、同一セグメント内のサーバ一覧(ブラウズリスト)を提供する
b. ドメインマスタブラウザは、複数セグメントにまたがるネットワークで使用される
c. WINSサーバは、FQDNとIPアドレスの対応付けを行う
d. NetBIOS名は、Windowsネットワークにおけるホスト名を指す

正解は、「a. ローカルマスタブラウザは、同一セグメント内のサーバ一覧(ブラウズリスト)を提供する」および「2.ドメインマスタブラウザは、複数セグメントにまたがるネットワークで使用される」です。
Windowsネットワークでは、NetBIOS名と呼ばれるコンピュータ名を用いた通信が行われます。
ローカルマスタブラウザは、その中でブラウザリストと呼ばれる同一セグメント内のサーバ一覧を提供する役割を担っています。ドメインマスタブラウザは、複数セグメントにまたがるネットワークで用いられるマスタブラウザとなります。
また、WINSサーバはNetBIOS名とIPアドレスの対応付けを行うサーバであり、Sambaを用いて構築することが可能です。

[040]390.2 ディレクトリの保護
以下の説明のうち、OpenLDAPのセキュリティに関して正しいものを2つ選択せよ。

a. 非認証バインドとは、認証にユーザー名のみが使用される。
b. OpenLDAPのStartTLSでは、636/TCPが使用される。
c. SASLは、認証時のユーザー名およびクライアントパスワードを暗号化する。
d. OpenLDAPへのアクセスには、iptablesで389/TCPと636/TCPを許可する必要がある。

正解は、「a. 非認証バインドとは、認証にユーザー名のみが使用される。」と「d. OpenLDAPへのアクセスには、iptablesで389/TCPと636/TCPを許可する必要がある。」です。
不正解の選択肢については、正しくは以下となります。

OpenLDAPのStartTLSでは、389/TCPが使用される。
SASLは、認証時のクライアントパスワードを暗号化する。
OpenLDAPでは、ldapとして389/TCP・ldapsとして636/TCPが使用されます。また、StartTLSを設定した場合、389/TCPで暗号化通信が行われます。
そのため、iptablesなどファイアウォール機能では各ポートでの通信を許可する必要があります。
SASL(Simple Authentication and Security Layer)を利用することで、OpenLDAPの認証時にクライアントパスワードを暗号化することが可能になります。
OpenLDAPへ接続するユーザー認証は、通常ユーザー名とパスワードを使って行われますが、OpenLDAPでは非認証バインド(認証にユーザー名のみが使用される)や匿名バインド(ユーザー名もパスワードも使用されない)を使うこともできます。

[041]392.1 Sambaの概念とアーキテクチャ
SMBプロトコルで通信を行う際に利用するポートで間違っているものを1つ選択してください。

a. TCPポートの138番
b. TCPポートの139番
c. UDPポートの137番
d. UDPポートの138番

正解は、「a. TCPポートの138番」です。
SMB(Server Messaging Block)プロトコルは、Windowsマシンでのファイルおよびプリンタ共有サービスで広く利用されているプロトコルです。現在ではCIFS(Common Internet File System)と呼ばれることもあります。
SMBプロトコルはNetBIOSというインターフェース上で動作します。NetBIOSのうちTCP/IP上で動作するものをNetBIOS over TCP/IP略してNBTと呼びます。NBTでは基本的にTCPポートの139番を使って通信を行います。
よって、選択肢「2. TCPポートの139番」はSMBプロトコルで通信を行う際に利用するポートとなります。
また、名前解決とデータグラム通信にはUDPポートの137番および138番を利用します。そのため、選択肢「3. UDPポートの137番」と「4. UDPポートの138番」もSMBプロトコルで通信を行う際に利用するポートとなります。

選択肢aにあるTCPポートの138番はSMBプロトコルの通信では利用しません。
これにより問題の答えである、SMBプロトコルで通信を行う際に利用するポートで間違っているものは「a. TCPポートの138番」となります。

最近のWindowsマシンでは、TCP上に直接SMBを実装し、NetBIOSを介さないDirect Hosting of SMBというプロトコルが主に利用されています。このプロトコルの通信では、TCPポートの445番を利用します。
NetBIOSを介して通信を行う場合は利用するポートが3つありますが、Direct Hosting of SMBのプロトコルで通信を行う場合は、利用するポートが1つだけのため、ファイアウォールなどでの管理も容易となっています。

[042]390.2 ディレクトリの保護
SASL認証でユーザ情報を登録しているデータベースとして正しいものを一つ選択してください。

a. /etc/sasldatabase2
b. /etc/sasluserdb
c. /etc/saslpasswd
d. /etc/sasldb2

正解は、「d. /etc/sasldb2」です。
SASL(Simple Authentication and Security Layer)とは、認証やセキュリティに関する処理を行うためのフレームワークです。
SASLは、OpenLDAPやpostfixなど様々なソフトウェアに対応しており、LDAPでもSASL認証が利用できるようになっています。
SASL認証では、認証時にエントリ名とパスワードが暗号化がされます。そのため、SASL認証を利用することで認証のセキュリティを強化することができます。
SASLを使った認証には、SASLデータベースが使われます。SASL認証で登録されたユーザ情報はSASLデータベースである「/etc/sasldb2」に格納されます。
よって正解は「d. /etc/sasldb2」となります。

SASLデータベースにユーザを追加する際の書式は以下の通りです。
# saslpasswd2 -u <ドメイン名> -c <ユーザ名>

登録したユーザ情報はSASLデータベース(/etc/sasldb2)に格納されます。
SASLデータベースはバイナリファイルですので、登録されているユーザ情報を確認するには「sasldblistusers2」コマンドを実行します。

[043]392.5 国際化
以下のsmb.confのパラメータのうち、文字コードと関係がないものはどれか。

a. dos charset
b. display charset
c. unix charset
d. wins support

正解は、「d. wins support」です。
wins supportは、SambaのnmbdプロセスをWINSサーバとして機能させるかのパラメータとなります。
※WINSサーバ=WindowsネットワークにおけるNetBIOS名とIPアドレスの関連付けや変換を担う機能。

それ以外のパラメータは以下のような意味を持っています。
dos charset:SambaがDOSクライアントと通信する際に使用される文字コードを指定
display charset:Sambaが標準出力/標準エラー出力へメッセージ出力する際に使用される文字コードを指定
unix charset:Sambaが動作するUNIXマシンで使用される文字コードを指定

なお、Sambaの設定(smb.conf)に設定されているパラメータ 及びその値はtestparmコマンドなどを使って表示させることができます。

[044]394.1 ユーザアカウントとグループアカウントの管理
idmapのadバックエンドの説明として間違っているものを一つ選択してください。

a. adバックエンドはsmb.confの[global]セクションに設定する
b. adバックエンドを設定した場合でも、デフォルトのバックエンドを設定しなければならない
c. adバックエンドでは、WindowsユーザのUNIX属性のUIDの値をそのままUIDとして割り当てることができる
d. adバックエンドでは、WindowsユーザのSIDからUID、GIDが割り当てられる

正解は、「d. adバックエンドでは、WindowsユーザのSIDからUID、GIDが割り当てられる」です。
WindowsユーザのSIDとLinuxユーザのUIDやGIDをマッピングする機能をidmapと言います。
idmapの実体はidmapバックエンドというモジュールで、Sambaにはさまざまなidmapバックエンドがあります。

主なidmapのバックエンドは以下の通りです。
ldap :	 LDAPディレクトリに格納された割り当て情報を利用
tdb : 	ローカルのTDBファイルに格納された割り当て情報を利用
rid : 	Active Directoryに格納された割り当て情報を利用
ad : 	Active Directoryに格納された割り当て情報を利用

今回の例題にあるadバックエンドは、WindowsユーザのUNIX属性の値を使用して、UIDやGIDを割り当てることができます。
また、adバックエンドとは別にデフォルトのバックエンドを設定することは必須です。
よってadバックエンドの説明として間違っているものは
「d. adバックエンドでは、WindowsユーザのSIDからUID、GIDが割り当てられる」となります。
dの選択肢のような、WindowsユーザのSIDからUID、GIDが割り当てられるバックエンドは、ridバックエンドです。

[045]390.1 OpenLDAPのレプリケーション
OpenLDAPのレプリケーション動作に関する説明のうち、正しいものを1つ選択せよ。

a. refreshOnlyが設定された場合、セッションの接続維持がされた状態でレプリケーションが行われる。
b. refreshAndPersistが設定された場合、定期的にセッションを張りデータのレプリケーションが行われる。
c. ワンショットモードをでslurpdを起動した場合、複製ログを処理するとデーモンが終了する。
d. syncrepl方式でのレプリケーションでは、マスターサーバからスレーブサーバへLDAPデータの同期要求が行われる。

答えは「c. ワンショットモードをでslurpdを起動した場合、複製ログを処理するとデーモンが終了する。」です。
ワンショットモードとは、OpenLDAPのレプリケーションのうちslurpdを使用したデータ同期で指定できるモードで、このモードでslurpdを起動した場合、一度複製ログを処理した段階でデーモンが終了します。
なお、現在ではslurpdを使用したレプリケーションではなく、syncrepl方式と呼ばれるレプリケーションを使用するのが一般的です。 syncrepl方式では、マスターサーバをプロバイダ、スレーブサーバをコンシューマーと呼び、コンシューマーからプロバイダへのデータ同期要求が行われます。 また、データ同期のタイプとしてrefreshOnlyが設定された場合、定期的にセッションを張りデータ同期が行われます。 refreshAndPersistが設定された場合、セッションの接続維持がされた状態でレプリケーションが行われます。

[046]392.2 Sambaを設定する
Sambaの設定ファイルの内容を解析して、設定が正しいかどうか確認するコマンドとして適切なものをすべて選びなさい。

a. testparm /etc/samba/smb.conf
b. smbstatus
c. smbcontrol nmbd reload-config
d. testparm

答えは「a. testparm /etc/samba/smb.confと4. testparm」です。
testparmコマンドを実行すると、設定ファイルであるsmb.confファイルの文法チェックや設定可能なパラメータを確認することができます。
引数でsmb.confファイルのフルパスを指定して使用しますが、指定しない場合はデフォルトのパスのsmb.confファイルを解析できるので、「4. testparm」も正解になります。
testparmコマンドの主なオプションは以下の通りです。
-s … smb.confの内容を表示する前の確認を省略します。
-V … バージョンを表示します。
--parameter-name <parameter> … 指定されたパラメータをダンプします。セクション名が指定されない場合、表示は既定値で、グローバルセクションに制限されます。
--section-name <section> … 指定されたセクションをダンプします。
--show-all-parameters … パラメータ、タイプ、設定可能な値を表示します。
その他の選択肢の解説は以下です。
[2. smbstatus]
smbstatusコマンドはSambaの現在のコネクションやロック状態などステータスをチェックするためのコマンドです。
[3. smbcontrol nmbd reload-config]
smbcontrolコマンドは、Sambaを構成するプロセスに対して各種操作ができるコマンドです。
デーモン名(もしくはPID)とメッセージを指定します。
上記の例だと、設定ファイルsmb.confの再読み込みを行っています。
Sambaの設定が正しく行えるように、設定ファイルの書式チェックや再読み込みのコマンドを把握しておきましょう。

[047]393.2 Linuxファイルシステムと共有/サービスのパーミッション
マウントしたSambaのファイルシステム上にファイルを作成する際、smb.confにおいて必ず付与したい権限を指定するパラメータを選択せよ。

a. create mask
b. directory mask
c. force create mode
d. force directory mode

答えは「c. force create mode」です。
smb.confではファイルおよびディレクトリ作成時のパーミッションを指定できる複数のパラメータがあります。
テスト対策としては、それぞれのパラメータの役割・併用した際に付与されるパーミッションなどについて、しっかり把握しておく必要があります。
-------
create mask:ファイル作成時に付与されるパーミッションを指定。デフォルト値は、0744。
create mode:create maskの別名。
force create mode:ファイル作成時に必ず付与されるパーミッションを指定。デフォルト値は、0000。
directory mask:ディレクトリ作成時に付与されるパーミッションを指定。デフォルト値は、0755。
directory mode:directory maskの別名。
force directory mode:ディレクトリ作成時に必ず付与されるパーミッションを指定。デフォルト値は、0000。
実際に上記パラメータを設定した例を、以下に示します。
操作例1(create mask=0744,force create mode=0000でファイルtest.txtを作成した場合)
[share]
	comment = Test Shared Directory
	path = /var/tmp/share
	bwoseable = yes
	writeable = yes
	create mask = 0744
	force create mode = 0000
[root@localhost share]# ls -l
合計 0
-rwxr--r--. 1 kujirai kujirai 0  2月 11 10:55 test.txt・・・・パーミッションが0744になっている。
操作例2(create mask=0740,force create mode=0000でファイルtest2.txtを作成した場合)
[share]
	comment = Test Shared Directory
	path = /var/tmp/share
	bwoseable = yes
	writeable = yes
	create mask = 0740
	force create mode = 0000
[root@localhost share]# ls -l
合計 0
-rwxr--r--. 1 kujirai kujirai 0  2月 11 10:55 test.txt
-rwxr-----. 1 kujirai kujirai 0  2月 11 10:57 test2.txt・・・・パーミッションが0740になっている。
操作例3(create mask=0740,force create mode=0020でファイルtest3.txtを作成した場合)
[share]
	comment = Test Shared Directory
	path = /var/tmp/share
	bwoseable = yes
	writeable = yes
	create mask = 0740
	force create mode = 0020
[root@localhost share]# ls -l
合計 0
-rwxr--r--. 1 kujirai kujirai 0  2月 11 10:55 test.txt
-rwxr-----. 1 kujirai kujirai 0  2月 11 10:57 test2.txt
-rwxrw----. 1 kujirai kujirai 0  2月 11 11:01 test3.txt・・・・パーミッションが0760になっている。

[048]392.2 Sambaを設定する
Sambaの設定ファイルにはSamba変数を使用することができます。
以下のSamba編集の説明のうち、誤っているものを選択してください。

a. %u 接続しているユーザ名
b. %d 現在のディレクトリ名
c. %P 共有のルートディレクトリ
d. %T 現在の日付と時刻

答えは「d. %d 現在のディレクトリ名」です。
Sambaの設定ファイルでは、多くのSamba変数を使用することができます。
例えば、Samba変数を使用すると
[tmpdir]
        path = /var/tmp/%u
        comment = %u's temporary directory
        writable = yes
のように設定することができます。
この場合、%u は接続ユーザ名に置き換わるので、同じ共有名でユーザ毎に異なるディレクトリを共有することができます。
その他、下記のようなSamba変数を使用することができます。
%U クライアントが要求したユーザ名
%G %Uのグループ名
%u 接続しているユーザ名
%g %uのグループ名
%m クライアントのNETBIOS名
%L サーバのNETBIOS名
%M クライアントのホスト名
%d Sambaサーバのプロセス番号
%T 現在の日付と時刻
%S 接続している共有名
%P 接続している共有名のルートディレクトリ
%H %uのホームディレクトリ

例題の選択肢について解説します。
a. %u 接続しているユーザ名
c. %P 共有のルートディレクトリ
d. %T 現在の日付と時刻
a, c, dは正しい説明です。
b. %d 現在のディレクトリ名
%dはSambaサーバのプロセス番号に置き換わります。
よって b は誤っています。
Samba変数は上記で紹介したものがすべてではありません。

[049]392.4 Sambaのトラブルシューティング
SambaのデータベースであるTDBファイルの内容を表示するためのコマンドは何か、コマンド名を答えよ。

答えは「tdbdump」 です。
SambaのドデータベースであるTDB（Trivial DataBase）ファイルの内容を表示するためには、tdbdumpコマンドを使用します。
TDBファイルは、/var/lib/sambaや/var/lib/samba/privateなどに格納されます。
-------
[root@localhost samba]# pwd
/var/lib/samba
[root@localhost samba]# ls
account_policy.tdb  gencache.tdb       printing      share_info.tdb
browse.dat          group_mapping.tdb  private       smbprofile.tdb
drivers             lock               registry.tdb
[root@localhost private]# pwd
/var/lib/samba/private
[root@localhost private]# ls
msg.sock  passdb.tdb  secrets.tdb

各TDBファイルは、以下のような情報を格納します。
account_policy.tdb（パスワード有効期限などの情報）
gencache.tdb（キャッシュ用のデータベース）
share_info.tdb（共有レベルのACL構成設定）
group_mapping.tdb（グループマッピング情報）
passdb.tdb（SambaのSAMアカウント情報）
secrets.tdb（LDAPと共に使われる秘密パスワードなど）

また、以下はpassdb.tdbをtdbdumpで表示したものです。
[root@localhost private]# tdbdump passdb.tdb
{
key(13) = "RID_000003e8＼00"
data(8) = "kujirai＼00"
}
{
key(13) = "RID_000003e9＼00"
data(9) = "testuser＼00"
}

TDBファイルを操作するためのコマンドとしてはtdbdump以外に、
TDBファイルをバックアップ/リストアするtdbbackup/tdbrestoreがあり
tdb-toolsパッケージをインストールすることで導入できますので、併せて覚えておきましょう。

[050]392.3 Sambaの保守
smbstatusコマンドのオプションと説明の組み合わせのうち、正しいものを選択せよ。

a. -p：smbdのプロセス一覧を表示する
b. -s：接続一覧を表示する
c. -U：指定ユーザーに関する情報のみ表示する
d. -S：設定ファイルを指定する

答えはa.-p：smbdのプロセス一覧を表示する です。
smbstatusコマンドは、現状におけるsambaの接続に関する情報等を表示するものです。
また、選択肢 b.からd. については、それぞれ正しくは以下のようになります。
-s：設定ファイルsmb.confなどを指定する
    ※smb.confには、Samba全体の動作を設定する[global]セクション・ユーザーのホームディレクトリに関する設定を行う[homes]セクション・プリンター用の[printers]セクションなどに関する設定が含まれる。
-U：存在せず。正しくは、-u：指定ユーザーに関する情報のみ表示する
-S：接続一覧を表示する

[051]394.2 認証と許可およびWinbind
Sambaのパスワードデータベースをセットアップします。
smb.conf の passwd backend に設定する内容として、誤っているものを選択してください。

a. passdb backend = tdbsam
b. passdb backend = ldapsam:ldap://127.0.0.1
c. passdb backend = passwd:/etc/passwd
d. passdb backend = smbpasswd

答えは「c. passdb backend = passwd:/etc/passwd」です。
Sambaのパスワードデータベースは、いくつかの種類から選択して使用することができます。
下記の種類のデータベースを選択することができます。
* tdbsam
TDB(Trivial Database)からユーザ情報を参照します。
Samba 3.x から使用できるようになり、標準のパスワードデータベースとなっています。
TDBをメンテンスするために、専用ツール(tdbbackup, tdbrestore, tdbdump 等)を使用することができます。

* smbpasswd
テキスト形式のsmbpasswdファイルからユーザ情報を参照します。
Samba 2.x で使用されていたパスワードデータベースです。
tdbsamより格納できる情報が少ないため、今ではあまり使用されません。
後方互換性のために Samba 3.x/4.x でも使用できるようになっています。

* ldapsam
LDAPからユーザ情報を参照します。
LDAPを利用すると、他のSambaサーバやWindowsサーバ等とユーザ情報を一元管理することができます。

それぞれの選択肢について解説します。

a. passdb backend = tdbsam
正しいです。
パスワードデータベースにTDBを使用する設定です。

b. passdb backend = ldapsam:ldap://127.0.0.1
正しいです。
パスワードデータベースにLDAPを使用する設定です。
この設定の場合、127.0.0.1のLDAPサーバに接続します。

c. passdb backend = passwd:/etc/passwd
誤りです。
パスワードデータベースに passwd という指定はできません。

d. passdb backend = smbpasswd
正しいです。
パスワードデータベースに smbpasswd を使用する設定です。

[052]397.1 CIFS連携
CIFSファイルシステムをマウントするmountコマンドのオプションの説明として、誤っているものを選択してください。

a. username=<user>
   CIFSに接続するユーザ名を<user>に指定する。
b. password=<password>
   CIFSに接続するパスワードを<password>に指定する。
c. secret=<filename>
   CIFS接続時に使用するユーザ、パスワード、ドメインを記載したファイルを<filename>に指定する。
d. uid=<username or uid>
   マウントされたファイルシステムの全ファイル・ディレクトリの所有者を<username or uid>に設定する。

答えは「c. secret= CIFS接続時に使用するユーザ、パスワード、ドメインを記載したファイルをに指定する。」です。
CIFS(Common Internet File System)は、Windowsのファイル共有であるSMBをWindows以外でも使用できるようにしたものです。
LinuxはCIFSに対応しており、LinuxクライアントからリモートのCIFS共有領域をマウントすることができます。
CIFSをマウントする場合、以下のようにmountコマンドを実行します。
# mount -t cifs -o rw,uid=2000,gid=2000,username=user01,password=pass01 //SV01/share /share

上記の例では、CIFSサーバSV01上の共有領域shareを/shareにマウントしています。
ユーザ、パスワードをファイルに記載しておき、マウント時にそのファイルを指定することもできます。
# mount -t cifs -o rw,uid=2000,gid=2000,credentials=/etc/secret/cifs //SV01/share /share

Linux起動時にCIFSの自動マウントを行いたい場合、/etc/fstabにマウント情報を記載する必要があります。
/etc/fstabはすべてのユーザが参照できるようになっているため、パスワードを直接設定するのはセキュリティ上問題があります。この場合、credentials オプションを使用するのがよいでしょう。

それぞれの選択肢について解説します。

a. username=<user>
   CIFSに接続するユーザ名を<user>に指定する。
正しいです。
CIFSマウント時に使用するユーザは username または user オプションで指定します。
username オプションを省略した場合、環境変数 USER の値が使用されます。

b. password=<password>
   CIFSに接続するパスワードを<password>に指定する。
正しいです。
CIFSマウント時に使用するパスワードは password オプションで指定します。
password オプションを省略すると、環境変数 PASSWD の値が使用されます。
環境変数 PASSWD も設定されていない場合、パスワード入力プロンプトが表示されます。

c. secret=<filename>
   CIFS接続時に使用するユーザ、パスワード、ドメインを記載したファイルを<filename>に指定する。
誤っています。
CIFS接続時のユーザ、パスワードを記載したファイルを指定する場合は credentials オプションを使用します。

d. uid=<username or uid>
   マウントされたファイルシステムの全ファイル・ディレクトリの所有者を<username or uid>に設定する。
正しいです。
uid オプションを指定してCIFSマウントをすると、マウントポイント配下のファイルやディレクトリの所有者がすべてuidで指定したユーザになります。同じように gid オプションを指定すると、所有グループがgidで指定したグループになります。

[053]393.2 Linuxファイルシステムと共有/サービスのパーミッション
Sambaの設定ファイルsmb.confで設定するパラメータと説明の組み合わせで、間違っているものはどれか、選択せよ。

a. force create mode : Sambaによって作成されたファイルに必ず適用されるパーミッション
b. browsable : WebブラウザからSambaへのアクセスを許可するかどうか
c. hide dot files : ドットで始まるファイル名のファイルを隠しファイルとして扱うかどうか
d. writeable : ファイル等の書き込みを許可するかどうか

答えはb. browsable : WebブラウザからSambaへのアクセスを許可するかどうか となります。
正しくは、　browsable ： クライアントのブラウズリストに共有として表示させるかどうか です。
smb.confのパラメータはパラメータの数が多く、
例えば writeableと同等の事を設定できるものとして writable・write okやread onlyなど複数存在するのも特徴です。
また、設定したsmb.confの正当性を確認には、testparmコマンドを使用する方法があります。

[054]390.3 OpenLDAPサーバのパフォーマンスチューニング
OpenLDAPサーバでは、データ検索を効率的に行うためにインデックスを設定することができます。
近似検索を行いたい場合に指定する設定を選択せよ。

a. pres
b. eq
c. sub
d. approx
e. none

答えはd. approx です。
他の選択肢は以下のような意味を持ちます。
pres：	属性に値が含まれている
eq：	属性の値と完全一致する
sub：	属性の値に部分一致する
none：	インデックスを作成しない

インデックスの設定は以下のように行います。
olcDbIndex: uid eq,pres
※uidは、「pres」と「eq」が設定されていることを示す。
なお、同様の設定をLDIF形式ではなくslapd.confに設定する場合、以下のように設定します。
index uid eq,pres
また、インデックス設定に基づいてインデックスを作成するslapindexコマンドについても、併せて学習しておきましょう。

[055]395.2 Samba4のAD互換ドメインコントローラ
Samba4で使用されるポート番号と説明の組み合わせとして間違っているものを選びなさい。

a. TCP/UDP 88 : ケルベロス
b. TCP/UDP 445 : SMB
c. TCP 636 : LDAPS
d. TCP 3268 : RPC

答えはd. TCP 3268 : RPC です。
正しくは、TCP 3268 : グローバルカタログ となります。
Active Directoryのドメインコントローラとして対応可能なSamba4は、ファイルサーバ機能・プリントサーバ機能・ドメインコントローラ機能・名前解決サービス・グループポリシー管理機能など様々なサービスの有効化が可能です。
Samba4を理解する上で、どのようなサービスが使用されていて、それぞれのサービスではどのポート番号が利用されているか確認しておきましょう。
実運用を考えても、ファイアウォール設定などのセキュリティを考慮する際には必要な知識となりますので、今回の問題にあったもの以外についても把握しておきましょう。

その他、Samba4で使用されているポート番号
TCP/UDP 53 : 	DNSサービス
TCP 135 : 		RPC
TCP 139 : 		NetBIOSセッションサービス
TCP 389 : 		LDAP
TCP/UDP 464 : 	ケルベロスパスワード
TCP 3269 : 		グローバルカタログ(SSL)

[056]392.5 国際化
Linuxに設定したsamba共有をWindowsのドライブに割り当て、コマンドウィンドウでDIRコマンドを実行したところ、日本語のファイル名が化けた。
下記はsmb.confの一部だが、修正すべき行は次のうちどれか。なお、Windowsの地域設定は日本語である。

a. unix charset = UTF-8
b. display charset = UTF-8
c. dos charset = UTF-8
d. default case = lower
e. case sensitive = yes

答えはc. dos charset = UTF-8　です。
日本語Windowsのコマンドウィンドウでは、CP932が使用されるので、dos charset = CP932 とする必要があります。

LinuxとWindowsという異種OS間でファイルを共有すると、さまざまなトラブルに遭遇します。
これらをスマートに解決するには、下記に挙げるLinuxとWindowsのファイルシステムおよびファイルの違いを理解しておくことが重要です。

1. ファイル名の制約の違い
2. ファイル内の文字セットの違い
3. 改行コードの違い
4. BOM(Byte Order Mark)

1. ファイル名の制約の違い
Windowsではファイル名の大文字小文字は区別しせんが、Linuxでは区別します。また、LinuxはUTF8、WindowsのコマンドウィンドウではCP932の文字セットを使用するので、日本語のファイル名を正しく処理するには文字セットを正しく設定する必要があります。
なお、Windowsのエクスプローラで参照する場合は問題となりません。例えば、日本語(CP932)のファイル名と韓国語(CP949)のファイル名はエクスプローラでは正しく表示されます。

2. ファイル内の文字セットの違い
Windowsでは地域の設定により使用される文字セット（コードページ）が決まり、日本語環境ではCP932を使用します。WindowsのコマンドウィンドウでCHCP コマンドを引数無しで実行すると、現在のコードページが確認できます。
一方、LinuxではUTF8が使用されていますが、ユーザごとに使用環境に合わせてlocaleのLC_CTYPEで指定する文字セットに指定が可能です。localeコマンドで現在の設定を確認できます。

3. 改行コードの違い
Windowsではテキストファイルの行末にCR+LFが使用されますが、LinuxではLFのみが使用されます。
CRは復帰(Carriage Return)コードで、LFは改行(Line Feed または New Line)コードで、16進表記(Hexadecimal)でLFが0a、CRが0dになります。
man ascii コマンドで確認してみてください。

下記は a.txt を odコマンドを使用してASCIIコードまたは１６進(Hexadecimal)で表示した例で、a(61), b(62), c(63),
nl(0a)であることがわかります。

$ echo abc > a.txt
$ od -axv a.txt
0000000    a   b   c  nl
             6261    0a63
0000004

4. BOM(byte Order Mark)の違い
Windowsのアプリケーションは、ファイルをUnicodeで保存する時にBOMをファイルの先頭に挿入し、読み込み時にはBOMにより文字セットを識別しています。しかし、Linuxでは特にBOMを意識していないため、LinuxでUnicode(例えばUTF8)で作成した
a.txt
ファイルをWindowsで開いたときに文字が化けする可能性があります。逆に、Windowsで生成したUnicodeのファイルをLinuxでデータベースに取り込んだときに「何やらゴミが混入している」といった問題が発生する可能性があります。

下記は、Windows7のメモ帳(notepad)で、'xyz(改行)'を入力して、
「名前を付けて保存」で「文字コード」に'UTF-8'を指定して保存したx.txtに対しLinuxのodコマンドを実行した例です。なお、文字コードにANSIを指定すると、そのWindowsのコードページで保存されます。
xyz の前の ef bb bf は、この場合のBOMです。また、改行が cr(0d) nl(0a)(LF) であることがわかります。

$ od -axv x.txt
0000000    ?   ?   ?   x   y   z  cr  nl
             bbef    78bf    7a79    0a0d
0000010

その他、FTP
コマンドでファイルを転送する際のモードにbinaryとasciiがありますが、Windows-Linux間でasciiで転送するとテキストファイルの改行コードを変換(CR+LF⇔LF)してくれます。binaryで転送した場合、改行コードを変換しないため、viで開いた場合に
CRコードが ^M で表示されたりします。

その他の参考として、Windows環境でディレクトリパスの区切り文字の「＼」円マークと「＼」バックスラッシュは同じASCIIコード(0x5C)ですが、CP932環境では、円マークとして表示されます。表示環境の差で発生する違いであることも知っておきましょう。

[057]391.2 アクティブディレクトリおよびKerberosとLDAPの統合
Active DirectoryとLDAPの認証統合の説明として間違っているものを選びなさい。

a. Active DirectoryはLDAPをベースとしたディレクトリサービスである
b. Active DirectoryはKerberosによるシングルサイオン認証をサポートしている
c. Active Directoryでユーザー認証を行えば、Linux側での認証は不要となる
d. Active Directoryとの認証統合を行う主な用途としてSambaによるファイルサーバーが挙げられる

答えはc. Active Directoryでユーザー認証を行えば、Linux側での認証は不要となる です。
Active Directoryは、Windowsネットワークで利用されているディレクトリサービスです。ベースになっているのは、LDAPとKerberosですので、LinuxのLDAPやKerberosと基本的な相互互換性があります。ただし、Active Directoryは独自の拡張を行っている面もあるので、Windowsで利用できる機能がすべてLinuxでも使えるわけではありません。
Active DirectoryとLinuxを連携させる際に利用するのが、Kerberosによるシングルサイオン認証です。これはActive Directoryでユーザー認証を行うと、その後Kerberosをサポートし、Active Directoryと連携しているサービスはKerberosによる認証を行えるというものです。
実際には、認証を行っていないわけではなく、チケットをベースにした認証を行っています。Kerberosを使って認証を行いたいサービスは、あらかじめActive Directoryとの連携を設定しておきます。認証を行う際に、ユーザーはActive Directoryに対して当該サービスの認証チケットの発行を要求します。チケットが発行されると、そのチケットを使って当該サービスはユーザーを認証します。

このようなActive DirectoryとKerberosによるシングルサイオン認証を行うLinux上のサービスとしてSambaが挙げられます。Sambaは自身がActive Directoryのドメインコントローラーとして振る舞う他、Active Directoryのドメインに参加して、Active Directoryで認証を行ったユーザーに対してファイルサーバーの機能を提供することもできます。

[058]391.1 PAMおよびNSSとLDAPの統合
PAMとNSSをLDAPと連携させる理由として正しいものを選びなさい。

a. LDAPの情報でユーザー認証を行う
b. シングルサインオン認証を実現する
c. 認証情報を暗号化して通信する
d. 認証情報の脆弱性を検知する

答えはa. LDAPの情報でユーザー認証を行う です。
LDAPは階層型のデータベースとして、主にユーザーの認証情報を管理するために使われることが多くあります。このユーザー情報をログイン認証などに使用するために、PAMとNSSを使用します。PAMは認証プロセスをコントロールし、NSSは認証情報の参照先を設定します。
PAMを設定するには、/etc/pam.d/ディレクトリ内にある設定ファイルに記述を行います。様々な認証が存在しているので、その目的に合ったファイルで設定を行います。たとえばOSのログイン認証なら/etc/pam.d/system-authで設定を行います。PAMがLDAPを利用するためのモジュールとしてpam_ldap.soが用意されているので、このモジュールを利用するように設定を変更する必要があります。

NSSを設定するには、/etc/nsswitch.confに設定を行います。このファイルが取り上げられる例として、名前解決の参照先として/etc/hostsやDNSを設定する際に用いられますが、ユーザー認証ではpasswd、shadow、groupの設定でLDAPを参照するように設定します。

その他、PAMとNSSがLDAPを参照するための設定などが必要となる場合がありますので、使用するディストリビューションの環境に応じて設定する手順を確認しておきましょう。

[059]390.3 OpenLDAPサーバのパフォーマンスチューニング
OpenLDAPのインデックスの解説として間違っているものを選びなさい。

a. インデックスはデータの検索を高速化するための仕組みである
b. インデックスはすべての属性に設定しておく必要がある
c. インデックスはデータを追加した際に更新される
d. インデックスは属性ごとに種類を変更できる

答えはb. インデックスはすべての属性に設定しておく必要がある です。
OpenLDAPは階層型のデータベースですが、その他の種類のデータベース同様、検索を高速化するための仕組みとしてインデックスが用意されています。
インデックスは、存在するかどうか、等しいかどうか、部分一致検索など、属性ごとに持っているデータの種類や検索の方法に合わせた種類のインデックスを作成できます。
また、検索のために使用しないであろう属性には、明示的にインデックスを作成しないように設定できます。アプリケーションの用途によって検索対象になる属性は限られますので、そのような属性にのみインデックスを作成するようにしておくとよいでしょう。
インデックスを作成する属性を絞り込むメリットとして、ディレクトリにデータが追加される度にインデックスが更新されるときの負荷軽減があります。大量のデータを追加するような場合には、インデックス更新が頻繁に行われますので、インデックス無しの場合に比べて負荷が高くなります。そのような点も考慮に入れて、インデックスを作成する必要があります。

[060]390.2 ディレクトリの保護
OpenLDAPでSSL/TLSを使用して通信を保護するために不要なものを選びなさい。

a. CA（認証局）の証明書
b. サーバ証明書
c. サーバの秘密鍵
d. クライアント証明書

答えはd. クライアント証明書 です。
OpenLDAPとの通信を行うLDAPプロトコルをSSL/TLSで保護するには、HTTPS同様に各種暗号鍵、証明書を用意する必要があります。
まず、OpenLDAPサーバが使用するサーバ証明書が必要となります。サーバ証明書はCA（認証局）による電子署名が必要になりますが、小規模でプライベートな保護を行うのであれば、OpenSSLを使って自分でCAを作成する方法も選択できます。電子署名は、CAの秘密鍵が使用されます。

CAが電子署名したサーバ証明書には、CAの公開鍵が含まれます。サーバ証明書が正しいことを検証するには、このCA公開鍵が必要となります。CAの公開鍵は、OpenLDAPサーバに接続するLDAPクライアントにインストールする必要があります。

SSL/TLSで保護されたOpenLDAPサーバを動かすには、サーバの秘密鍵も必要になります。LDAPクライアントがサーバ証明書に含まれるサーバの公開鍵で暗号化した情報を、OpenLDAPサーバが復号するするために使用されます。

クライアント証明書は、接続認証を目的に使用します。たとえばOpenVPNなどでVPN環境を構築する際に、クライアント証明書を所有しているユーザーのみ接続を許可するなどの用途に使用されます。LDAPの通信を保護するという目的においては、クライアント証明書は必要ありません。

[061]390.3 OpenLDAPサーバのパフォーマンスチューニング
OpenLDAPのインデックスのオプションの説明として適切なものを選択してください。

a. presは、近似値の検索のインデックスを作成するオプションである
b. subは、文字列の部分一致検索のインデックスを作成するオプションである
c. eqは、値の存在を検索する場合のインデックスを作成するオプションである
d. approxは、値の完全一致検索のインデックスを作成するオプションである

答えは「b. subは、文字列の部分一致検索のインデックスを作成するオプションである」です。
OpenLDAPは、データの検索を高速化するためのインデックスを作成することができます。
インデックスは、olcDbIndexという属性で管理されています。
olcDbIndexの書式は以下の通りです。
olcDbIndex:  属性名のリスト   オプション[,オプション..]

上記のオプションの箇所にeq, sub, pres, approxのオプションを設定します。
オプションはカンマ区切りで複数指定可能です。
それぞれのオプションの意味は以下の通りです。

pres   値の存在を検索する場合のインデックスを作成する
sub    文字列の部分一致検索のインデックスを作成する
eq     値の完全一致検索のインデックスを作成する
approx 近似値の検索のインデックスを作成するオプションである

OpenLDAPの検索の効率化を行うには、上記のインデックスを適切に設定することが
必要です。ldapsearchコマンドなどで検索を行った場合に、ログにインデックスの情報も出力されます。

インデックスが使われない検索には「not indexed」のログが出力されます。
多く使われる検索条件で、「not indexed」が出ていないかを事前に確認しておきましょう。

[062]335.2 クラスタファイルシステム
OpenLDAPのレプリケーションの説明として間違っているものを選びなさい。

a. コンシューマーが多数ある場合、レプリカハブを用意することで負荷を低減できる
b. スレーブサーバがマスターサーバに接続して差分データを取得する
c. マルチマスターレプリケーションではデータの整合性が取れなくなる可能性がある
d. refreshAndPersistを設定すると複製したデータが永続化される

答えはd. refreshAndPersistを設定すると複製したデータが永続化される です。
ディレクトリのデータを複数のOpenLDAPサーバで保持し、利用したい場合にレプリケーションを構成します。
データの更新はマスターサーバで行われ、スレーブサーバはマスターサーバから更新情報を取得して自分のデータを変更していきます。このようにマスタースレーブ方式で構成するのが一般的な方法です。マスターのことを「プロバイダー」、スレーブのことを「コンシューマー」とも呼びます。

プロバイダーとコンシューマーは1対多の関係になるため、コンシューマーの数が多いとマスターサーバの負荷が高くなります。このような時には、マスターとスレーブの間をつなぐ「レプリカハブ」を用意し、レプリカハブが取得したデータをさらにコンシューマーに渡すような、多段構成でマスターサーバの負荷を低減することも可能です。

マスターのデータ更新に関する冗長性を高めたい場合、Active-Activeなマルチマスターレプリケーションを構成できます。ただし、同じデータに対して同時に更新を行った時に発生する「更新競合」を解決することができないので、通常運用時は片方だけをマスターとして利用し、障害が発生した時にもう一方のマスターを有効にするなど、あくまで障害発生時のデータ更新継続性を想定した構成・運用が必要になります。

コンシューマーがデータ更新のためにマスターに接続する際、接続・更新を行った後に接続を切断するrefreshOnlyと、接続を継続して適宜更新を継続するrefreshAndPersistの、2つの設定が選択できます。データ更新の頻度やより最新の同期状態にしておきたいかなど、必要に応じて設定を変えるとよいでしょう。

[063]335.2 クラスタファイルシステム
OpenLDAPのレプリケーションの説明として間違っているものを選びなさい。

a. コンシューマーが多数ある場合、レプリカハブを用意することで負荷を低減できる
b. スレーブサーバがマスターサーバに接続して差分データを取得する
c. マルチマスターレプリケーションではデータの整合性が取れなくなる可能性がある
d. refreshAndPersistを設定すると複製したデータが永続化される

答えは「d. refreshAndPersistを設定すると複製したデータが永続化される」です。
ディレクトリのデータを複数のOpenLDAPサーバで保持し、利用したい場合にレプリケーションを構成します。
データの更新はマスターサーバで行われ、スレーブサーバはマスターサーバから更新情報を取得して自分のデータを変更していきます。このようにマスタースレーブ方式で構成するのが一般的な方法です。マスターのことを「プロバイダー」、スレーブのことを「コンシューマー」とも呼びます。

プロバイダーとコンシューマーは1対多の関係になるため、コンシューマーの数が多いとマスターサーバの負荷が高くなります。このような時には、マスターとスレーブの間をつなぐ「レプリカハブ」を用意し、レプリカハブが取得したデータをさらにコンシューマーに渡すような、多段構成でマスターサーバの負荷を低減することも可能です。

マスターのデータ更新に関する冗長性を高めたい場合、Active-Activeなマルチマスターレプリケーションを構成できます。ただし、同じデータに対して同時に更新を行った時に発生する「更新競合」を解決することができないので、通常運用時は片方だけをマスターとして利用し、障害が発生した時にもう一方のマスターを有効にするなど、あくまで障害発生時のデータ更新継続性を想定した構成・運用が必要になります。

コンシューマーがデータ更新のためにマスターに接続する際、接続・更新を行った後に接続を切断するrefreshOnlyと、接続を継続して適宜更新を継続するrefreshAndPersistの、2つの設定が選択できます。データ更新の頻度やより最新の同期状態にしておきたいかなど、必要に応じて設定を変えるとよいでしょう。

[064]394.1 ユーザアカウントとグループアカウントの管理
pdbeditコマンドを使ってSambaのユーザデータベースからSambaユーザーを削除するコマンドを選びなさい。

a. pdbedit -a -u ユーザー名
b. pdbedit -x -u ユーザー名
c. pdbedit -a -U ユーザー名
d. pdbedit -x -U ユーザー名

答えは「b. pdbedit -x -u ユーザー名」です。
Samba3はsmbd、nmbd、winbindの3つのプロセスから構成されています。
Samba3では、ファイル共有、印刷サービスのほかに、NTドメインのネットワーク内でユーザの管理を行う機能が提供されています。
一方、Samba4はsmbd、nmbd、winbindの3つのプロセスにsambaプロセスを加えた4つのプロセスから構成されています。
Samba4からDNSサーバとLDAPサーバの機能を包括し、Active Directory（以下AD）の代替として機能することが出来るようになりました。このADの機能を提供するサービスがsambaプロセスとなります。

Samba3系以降のシステムで、Sambaのユーザデータベース管理にはpdbeditコマンドを使います。
pdbeditコマンドでは、Sambaユーザーの追加、削除、一覧表示などを行うことが可能です。
pdbeditコマンドは、管理者権限で実行する必要があります。

Sambaユーザーを削除するためには、pdbeditコマンドに「-x」オプション、対象のユーザ名を指定する「-u」オプションを指定する必要があります。

「1. pdbedit -a -u ユーザー名」は、Sambaユーザを追加する場合に使用します。
ユーザの追加時には、追加するSambaユーザのパスワードの設定も行います。

pdbeditコマンドには他にも様々なオプションを指定することができます。
以下は、代表的なオプションを使用した例です。
 -L ・・・ ユーザの一覧を表示する。
 -L -v  ・・・ ユーザの一覧の詳細を表示する。
 -G <<SIDまたは、RID>>  ・・・  ユーザの追加、変更時にプライマリグループのSIDまたは、RIDを指定する。
 -U <<SIDまたは、RID>> ・・・  ユーザの追加、変更時にユーザのSIDまたは、RIDを指定する。

[065]392.1 Sambaの概念とアーキテクチャ
Sambaに関する説明で正しくないものを選びなさい。

a. Samba3からDNS/LDAPの機能を包括するようになり、ActiveDirectoryの代替となることができる。
b. smbdはファイル共有、印刷サービスを提供するデーモンである。
c. winbindを使用することで、WindowsとLinuxのログインを統合することができる。
d. nmbdはSMB/CIFSクライアントのネームサービスリクエスト要求に応答することが出来る。

答えは「a. Samba3からDNS/LDAPの機能を包括するようになり、ActiveDirectoryの代替となることができる。」です。
Samba3はsmbd、nmbd、winbindの3つのプロセスから構成されています。
Samba3では、ファイル共有、印刷サービスのほかに、NTドメインのネットワーク内でユーザの管理を行う機能が提供されています。
一方、Samba4はsmbd、nmbd、winbindの3つのプロセスにsambaプロセスを加えた4つのプロセスから構成されています。
Samba4からDNSサーバとLDAPサーバの機能を包括し、Active Directory（以下AD）の代替として機能することが出来るようになりました。このADの機能を提供するサービスがsambaプロセスとなります。

また、各プロセスの機能は以下になります。

・smbd：
  ファイル共有と印刷サービスをWindowsクライアントに提供するデーモンです。
  smbdはNetBIOS over TCP上でSambaを使用するための139/tcpポートと、  445/tcpポートの2つで待ち受けしています。

・nmbd：
  NetBIOS名からIPアドレスを解釈する、またNetBIOSネームサービスの要求に応答することデーモンです。
  Sambaクライアントは、Sambaサーバを検索するためにNetBIOS名からIPアドレスを取得するときにnmbdを使用します。
  nmbdは137/tcpポートで待ち受けしています。

・winbind：
  winbindは、LinuxマシンをADで管理されるドメインのメンバーとして参加させるためのデーモンです。
  PAM/NSSとwinbindが連携することで、LinuxのソフトウェアがADの認証情報を利用できるようになります。

・samba：
  ADの機能を提供するデーモンです。Samba4.0.0以降で実装されています。
  Sambaが、ADの代わりとして動作することが可能となっています。

[066]393.1 ファイルサービス
以下のSambaのパラメータの中から共有フォルダへのアクセスに影響を与えない設定を選びなさい。

a. write list
b. invalid users
c. guest ok
d. browseable

答えは「d. browseable」 です。
SambaはWindows系OS互換のファイルサーバやプリントサーバ、ドメインコントローラとしての機能を提供するソフトウェアです。
代表的な機能としてはファイルサーバとしての機能であり、ネットワーク上に共有フォルダを公開し、複数のユーザでファイルを共有することができます。

「a. write list」はディレクトリへの書き込み権限を許可するユーザやグループを個別に指定する設定となります。この設定が指定された場合、リストに追加されたユーザやグループ以外はそのディレクトリへ書き込みをすることができなくなります。
「b. invalid users」は共有ディレクトリへのアクセスを拒否するユーザを指定する設定となります。
「c. guest ok」は、共有フォルダにゲスト権限でのログイン許可を制御します。
「d. browseable」はWindowsのエクスプローラなどで、ネットワーク上の共有フォルダを一覧表示した場合の、表示の有効/無効を切り替える設定です。表示の有無を制御するだけであり、共有フォルダへのアクセス権に影響を及ぼすことはありません。

ファイルを共有する場合、適切にアクセス制御を行わなければ意図しないユーザからファイルを操作される場合があるため、アクセス権に関する設定は抑えておくと良いでしょう。

[067]390.1 OpenLDAPのレプリケーション
refreshOnlyとrefreshAndPersistの違いについて正しい説明を選びなさい。

a. refreshAndPersistを設定した場合、定期的にデータの同期が行われる。
b. refreshOnlyを設定した場合、プロバイダからコンシューマへデータの同期を行う
c. refreshAndPersistを設定した場合、プロバイダからコンシューマへデータの同期を行う
d. refreshOnlyを設定した場合、プロバイダとコンシューマ間のセッションが常に維持される

答えは「c. refreshAndPersistを設定した場合、プロバイダからコンシューマへデータの同期を行う」です。
OpenLDAPはLDAPサーバ間でデータの同期を行い冗長構成で構築することが可能です。
このようにデータの同期を行うことをレプリケーションと呼びます。
プロバイダとはLDAPサーバ間でレプリケーションするデータの提供元となるサーバを指し、コンシューマとはプロバイダからプロバイダからデータを受け取る、またはプロバイダにデータを取りに行くサーバを指します。
refreshOnlyを設定した場合、データの同期を行うためにコンシューマからプロバイダへintervalの設定値に従って定期的に接続を行います。
リアルタイムの更新ではないため、プロバイダ側に登録された最新のデータをコンシューマが同期するまでタイムラグがあります。
そのため、一時的にプロバイダに存在するデータがコンシューマには存在しない状態が発生する、という特徴があります。
refreshAndPersistを設定した場合は、プロバイダからコンシューマへデータの同期を行います。
また、refreshAndPersistを設定した場合はプロバイダとコンシューマ間のセッションは常に維持されておりプロバイダでデータの更新が行われた場合にはプロバイダからコンシューマへリアルタイムにデータの同期を実行します。
データの同期を行うために常にプロバイダとコンシューマ間でセッションが維持されていますが、プロバイダのOpenLDAPが再起動された場合や通信エラーが発生した場合には、retryの設定値に従ってコンシューマからリトライが行われます。
コンシューマのOpenLDAPが再起動した場合は、コンシューマからプロバイダのOpenLDAPへ再度接続を行います。
接続できた場合、初回の同期はコンシューマから同期を要求し、プロバイダのデータをコンシューマに同期します。
以降はプロバイダに追加や変更されたデータはプロバイダからコンシューマへ同期が行われます。

[068]397.2 Windowsクライアントの操作
Windowsクライアントについての解説で間違っているものを選びなさい。

a. 「ネットワーク」を開くと、Windowsネットワークのブラウジングが行われる
b. net viewコマンドでWindowsネットワーク上のすべてのコンピューターをブラウジングできる
c. 自分の参加しているドメインまたはワークグループを確認するにはnet config workstationコマンドを実行する
d. Windowsクライアントからファイル共有にアクセスすると、デフォルトでログオン認証に使用したユーザ名とパスワードが認証に利用される

答えはb. net viewコマンドでWindowsネットワーク上のすべてのコンピューターをブラウジングできる です。
WindowsクライアントからWindowsネットワークのファイル共有やプリンタ共有にアクセスする一番基本的な操作は、Windows上のExplorerから「ネットワーク」を開くことです。この操作は、Windowsネットワークのブラウジングを行い、アクセス可能なコンピューターやプリンタを表示します。
たとえばコンピューターのアイコンをダブルクリックすると、認証が行われ、認証に成功すると利用可能な共有が表示されます。認証は、ログオンする際に使用したユーザー名とパスワードが利用され、もし認証できなかった場合には認証ダイアログが表示されて別のユーザー名とパスワードの入力が必要となります。

同様の操作が、「コマンドプロンプト」を起動して、netコマンドを実行することで行えます。「ネットワーク」の動作が思わしくない場合には、netコマンドを使って問題の切り分けが行えます。

たとえば、net viewコマンドを実行すると、自分が参加しているドメイン、またはワークグループのコンピューターのリストを表示します。自分が参加しているドメイン、ワークグループの確認には、net config workstationコマンドを実行します。

[069]396.2 アクティブディレクトリの名前解決
Samba4のDNSについての解説で間違っているものを選びなさい。

a. Samba4でアクティブディレクトリを構築するにはDNSの機能も必要となる
b. Samba4のDNS機能は、samba-tool dnsコマンドで操作できる
c. Samba4内部のDNSで名前解決できないリクエストはdns forwarderで指定したDNSで名前解決を行う
d. Samba4内部のDNSで管理するゾーン名はsmb.confで定義する

答えは「d. Samba4内部のDNSで管理するゾーン名はsmb.confで定義する」です。
Samba4でアクティブディレクトリのドメインコントローラーを構築するには、名前解決のためのDNS機能が必要となります。Samba4内部のDNS機能の他、DNSとしてよく使われているBINDと連携することもできます。BINDを使う場合は、BIND DLZで動的連携が可能なようにします。
Samba4内部のDNSは、Windowsの管理コンソール（MMC）の他、samba-tool dnsコマンドを使ってコマンドラインで操作することもできます。

Samba4内部のDNSは基本的にLAN内部で動作しているWindowsネットワーク、ADドメインの名前解決のために使用されているので、解決できない外部ドメインの名前解決リクエストは、smb.confに記述されたdns forwarderの設定に従って、別のDNSにリクエストを転送します。

Samba4内部のDNSのゾーン定義は、管理コンソールかsamba-tool dnsコマンドで行えます。たとえば、新しいゾーンを作成するにはsamba-tool dns zonecreateコマンドを使います。ただし、ドメインを初期化するsamba-tool domain provisionコマンドを使用した際に指定したドメイン名を使って、自動的に初期のゾーンが作成されます。

[070]396.1 NetBIOSとWINS
Windowsネットワークのネットワークブラウジング機能についての解説で間違っているものを選びなさい。

a. ネットワークブラウジング機能はSamba 3では主にnmbdが受け持っている
b. マスタ・ブラウザがコンピューター名とIPアドレスのリストを保持している
c. ドメインマスタブラウザはドメインに1つ必要となる
d. 複数セグメントに渡るWindowsネットワークの名前解決にはWINSサーバを利用する

答えは「b. マスタ・ブラウザがコンピューター名とIPアドレスのリストを保持している」です。
Windowsネットワークのネットワークブラウジング機能は、ネットワーク上にあるコンピュータの一覧を表示し、ファイル共有などの接続が行えるように名前解決を行って接続対象のIPアドレスを調べる仕組みです。Samba 3では主にnmbdプロセスがネットワークブラウジング機能を受け持っています。
コンピュータの一覧は、マスタ・ブラウザがブラウズリストとして保持しています。ネットワーク形態によって、ローカルマスタブラウザが存在したり、ドメイン環境ではドメインマスタブラウザがドメインに1つ動作します。マスタブラウザ機能が担うのはコンピュータの一覧であるブラウズリストを保持するだけで、名前解決、すなわち名前とIPアドレスの対応については別途行われます。

名前解決は、通常の名前解決同様、DNSを使うこともできますし、Windowsネットワークではブロードキャストによる名前解決も行われます。しかし、ブロードキャストはルーターを経由する別のネットワークには到達できないので、そのようなネットワークでWindowsネットワークの名前解決を可能にするにはWINSサーバーを構築します。WINSサーバーがコンピュータの名前とIPアドレスの情報を保持し、Windowsネットワーククライアントの名前解決要求に対応します。

[071]395.3 Sambaをドメインメンバーサーバとして設定する
SambaのADドメイン参加についての解説で間違っているものを選びなさい。

a. Samba4のみADドメインに参加させることができる
b. クライアントはアクティブディレクトリで認証を行う
c. Sambaへのアクセス認証はKerberos認証を利用する
d. ADドメインへの参加にはnetコマンドを利用する

答えは「a. Samba4のみADドメインに参加させることができる」です。
Sambaはドメインコントローラーだけでなく、ADドメインのメンバーサーバーとしてドメインに参加し、アクティブディレクトリで認証を行ったクライアントに対してファイル共有を提供することができます。
ADドメインのドメインコントローラーになることができる機能はSamba4からですが、ドメインメンバーになる機能はSamba3でも利用できます。

Sambaへのアクセス制御は、Kerberos認証を使います。Kerberos認証は、認証が行われるとKDC(Key Disstribution Center)からTGT(Ticket Granting Ticket)がクライアントに対して発行されます。クライアントはSambaにアクセスする時に、KDCに対してTGTを提示して、Sambaにアクセスするための認証チケットを要求します。発行されたチケットをSambaに提示することで、Sambaはクライアントに対してアクセスの許可を行う仕組みとなります。

SambaをADドメインのメンバーサーバーにするには、KDCを参照できるようにすること、Kerberos認証を行うREALM（レルム）に所属するように設定すること、そしてADドメインに参加する必要があります。ドメイン参加はnet ads joinコマンドを実行して、ADドメインにメンバーサーバーとして登録を行います。

[072]395.2 Samba4のAD互換ドメインコントローラ
Samba4をADのドメインコントローラーとして動作させるためにserver roleに設定する値として正しいものを選びなさい。

a. AUTO
b. ADS
c. CLASSIC PRIMARY DOMAIN CONTROLLER
d. ACTIVE DIRECTORY DOMAIN CONTROLLER

答えは「d. ACTIVE DIRECTORY DOMAIN CONTROLLER」です。
Samba4から通常のドメインコントローラーだけでなく、Active Directoryのドメインコントローラーとしての機能も追加されました。この機能を有効にするためには、Samba4の役割を設定するserver roleの値をsmb.confに指定する必要があります。
server roleのデフォルト値はAUTOですが、この場合従来同様smb.confに指定したsecurityの設定値に従ってSambaの役割が設定されます。

Active Directoryのドメインコントローラーとして設定するには、server roleの値をACTIVE DIRECTORY DOMAIN CONTROLLERに設定します。

CLASSIC PRIMARY DOMAIN CONTROLLERは、従来のプライマリドメインコントローラー（PDC）として動作します。もし、バックアップドメインコントローラー（BDC）として動作させるSambaサーバーも作る場合には、server roleを NETBIOS BACKUP DOMAIN CONTROLLERに設定する必要があります。

ADSという設定値は、Active Directoryでの認証を利用するsecurityの設定値です。

[073]395.1 SambaのPDCとBDC
ドメインコントローラーについての解説で間違っているものを選びなさい。

a. ドメインコントローラーはWindowsクライアントのドメインログオン認証を行う
b. PDCはドメインマスターとしてドメイン情報を管理する
c. 移動プロファイルを設定すると、ユーザーの固有情報をサーバーに保管できる
d. 移動プロファイルの保管場所はログオンスクリプト内に記述しておく

答えは「d. 移動プロファイルの保管場所はログオンスクリプト内に記述しておく」です。
ドメインコントローラーは、ドメインに参加しているWindowsクライアントに対して、ログオン認証を提供するサーバーです。Sambaはこのドメインコントローラーの役割を担う機能を備えています。
ドメインコントローラーが障害を起こすと、Windowsクライアントはログオン認証を行うことができなくなってしまうので、複数台のサーバーを用意して冗長化を行います。複数サーバーの中で主にドメインの各種情報を管理するのがPDC（プライマリドメインコントローラー）であり、Windowsネットワークの中ではドメインマスターの役割を担います。BDC（バックアップドメインコントローラー）は、PDCからドメイン情報の複製を受け取り、高負荷時、あるいはPDC障害時にはPDCに代わってログオン認証を行います。

Windowsクライアントは、ユーザーの各種情報をプロファイルとして保持します。通常はローカルプロファイルとして、使用しているWindowsクライアントにプロファイルを保持しますが、マシンを変更するとプロファイルが共有されません。そこで、移動プロファイルを設定すると、プロファイルをサーバー上に保持しておくことができます。

移動プロファイルの仕組みは、最初のログオン時にローカルプロファイルが作成されますが、ログオフ時にプロファイルをサーバー上にコピーします。別のマシンでドメインログオンすると、サーバー上の移動プロファイルがローカルにコピーされます。移動プロファイルの保管場所は、Sambaにログオンパス（logon path）として指定しておきます。

[074]394.2 認証と許可およびWindbind
Winbindについての解説で間違っているものを選びなさい。

a. Winbindを使用するとADやSambaの認証情報をLinuxから利用できる
b. libnss_winbindは認証情報取得にWinbindを利用するためのライブラリである
c. libpam_winbindはPAMの認証にWinbindを利用するためのライブラリである
d. wbinfoコマンドを利用してWinbindをADドメインに参加させることができる

答えは「d. wbinfoコマンドを利用してWinbindをADドメインに参加させることができる」です。
Linuxの認証は、たとえば/etc/passwdファイルや/etc/shadowファイルを使用したり、OpenLDAPを使用したりできますが、これらと同様にWindows上で動作するActive DirectoryやSambaの認証情報をLinuxから利用できるようにするのがWinbindです。
libnss_winbindは、LinuxのNSS（Name Service Switch）からWinbindを利用できるようにするためのライブラリです。NSSの設定は/etc/nsswitch.confであり、この中でたとえばユーザー名などをWinbind経由で取得するように設定することができるようになります。

libpam_winbindは、Linuxの認証システムであるPAMからWinbindを利用できるようにするためのライブラリです。PAMの設定ファイルにpam_winbind.soを使用するように設定します。

wbinfoコマンドは、Winbindの機能を受け持っているwinbindデーモンに対して問い合わせを行うコマンドです。Winbindの導入後、動作確認などに使用する事ができます。ドメインへの参加などは設定ファイルで行いので、wbinfoコマンドでドメイン参加を設定する事はできません。

[075]394.1 ユーザアカウントとグループアカウントの管理
samba-toolについての解説で間違っているものを選びなさい。

a. samba-toolを使うと、Samba 4で構築したActive Direcoryを操作できる
b. ユーザー追加は samba-tool user createコマンドを使用する
c. グループ参加者の確認は samba-tool group listコマンドを使用する
d. Winbindを利用する事でsamba-toolで登録した情報をLinuxで利用できる

答えは「c. グループ参加者の確認は samba-tool group listコマンドを使用する」です。
以前のバージョンのSambaではユーザー登録にはsmbpaswdコマンドを使用していましたが、Samba 4で構築したActive Directoryにユーザー、グループを登録するにはsamba-toolコマンドを使用します。samba-toolコマンドは、他にDNSなどの設定も行えます。
ユーザー追加を行うには、user createサブコマンドを指定してsamba-toolコマンドを実行します。互換性の観点から、user addサブコマンドも指定可能です。

グループ関係の処理を行うには、groupサブコマンドを指定します。たとえばグループを追加するにはgroupaddサブコマンド、さらにグループにユーザーを追加するにはgroup addmembersサブコマンドを指定します。情報確認には、グループの一覧はgroup listサブコマンド、グループに所属しているユーザーの一覧はgroup listmembersサブコマンドを指定します。

以前のSambaでは、ユーザーはまずLinux上に作成し、その後にSambaに登録していましたが、Winbindを使用する事でSambaに登録したユーザーをLinux側で使用したり、PAMと連動してLinux側で認証を行うことなどもできます。

[076]393.3 プリントサービス
Sambaのプリンタ共有についての解説で間違っているものを選びなさい。

a. SambaはLinuxで設定されたプリンタを自動的にプリンタ共有としてWindowsクライアントに提供することができる
b. Sambaのプリンタ共有を利用するには、Windowsクライアントにプリンタドライバをインスト－ルする必要がある
c. Sambaのプリンタ共有を利用するには、Linuxにプリンタドライバをインスト－ルする必要がある
d. SambaはWindowsクライアントのプリンタドライバを自動でインストールさせることができる

答えは「c. Sambaのプリンタ共有を利用するには、Linuxにプリンタドライバをインスト－ルする必要がある」です。
Sambaのプリンタ共有は、Linuxに接続、設定されているプリンタをWindowsクライアントに共有プリンタとして利用可能にする機能です。LinuxのプリンタはlpやCUPSで利用可能な状態になっている必要があります。
プリンタは通常、印刷するデータを「ページ記述言語」と呼ばれるデータ形式で受け取って印刷を行います。ページ記述言語で有名なのは「PostScript」ですが、メーカーや機種毎によって異なっています。プリンタドライバの役割は、アプリケーションのデータをページ記述言語のデータへと変換することにあります。そのため、Windowsクライアントにプリンタドライバをインストールすれば、SambaはLinuxのプリンタに対してそのデータを受け渡すだけでよいので、Linuxにプリンタドライバをインストールする必要はありません。

プリンタドライバの自動ダウンロード機能は、Sambaで作成したプリンタ共有にあらかじめWindowsクライアント用のプリンタドライバをアップロードしておきます。Windowsクライアントにプリンタドライバがインストールされていない場合、必要なプリンタドライバをダウンロードしてきて、インストールする事ができます。

[077]393.2 Linuxファイルシステムと共有/サービスのパーミッション
Sambaのパーミッションについての解説で間違っているものを選びなさい。

a. SambaはLinux側のパーミッションを利用してアクセス制御を行う
b. デフォルトパーミッションはcreate maskやdirectory maskで設定される
c. force create modeやforce directory modeを設定するとパーミッションを変更できない
d. ACLによるアクセス制御はext3ファイルシステムのみサポートしている

答えは「d. ACLによるアクセス制御はext3ファイルシステムのみサポートしている」です。
Sambaのファイル共有は、アクセス制御にLinuxのファイルシステム側のパーミッションを利用しています。一般的なPOSIXのパーミッションの他、ファイルシステムがACL(Access Control List)をサポートしている場合、ACLを利用したアクセス制御も行えます。ACLはext2やext3ファイルシステムなど、様々なファイルシステムで利用できますが、マウントする際にaclオプションをつけてマウントする必要があります。
Samba側の設定としては、create maskやdirectory maskでデフォルトパーミッションを設定する必要があります。maskとなっていますが、シェル環境でのumaskなどと異なり、設定したいパーミッション値をそのまま指定する点に注意が必要です。

○create maskの設定例
create mask = 0755

create maskやdirectory maskはあくまでデフォルトパーミッションを設定するだけなので、作成後のファイルやフォルダのパーミッションは変更できてしまいます。もし、利用者にパーミッションの変更を許したくない場合には、force create modeやforce directory modeでパーミッションを強制しておく必要があります。

[078]393.1 ファイルサービス
Sambaのファイル共有についての解説で間違っているものを選びなさい。

a. [homes]で共有を適切に設定することで、ユーザーのホームディレクトリを共有できる
b. smbcquotasで容量制限の設定や確認が行える
c. IPC$は利用可能なリソース情報の取得などを行うための特殊な共有である
d. mountコマンドではSambaの共有をLinuxでマウントすることができないのでsmbmountコマンドを使用する

答えは「d. mountコマンドではSambaの共有をLinuxでマウントすることができないのでsmbmountコマンドを使用する」です。
Sambaのファイル共有は、Linux上で共有するディレクトリを用意し、smb.confで共有を設定することで各種クライアントに対してファイル共有として提供することができるようになります。
[homes]はやや特殊な共有で、共有するディレクトリを特定せず、Sambaで認証を行ったユーザーのLinuxでのホームディレクトリを共有として提供することができます。たとえばユーザーlpicのホームディレクトリが「/home/lpic」だった場合、この/home/lpicが「lpic共有」として提供されます。このユーザーホーム共有は、ユーザー認証と結びついているため、別のユーザーからは共有することができません。

IPC$は特殊な共有で、そのホストが持っている利用可能なリソース情報などを提供する共有です。もちろん、アクセスする前には認証が必要となります。

Sambaは主にWindowsクライアントに対してファイル共有を提供しますが、LinuxクライアントからもSambaのファイル共有にアクセスできます。smbmountコマンドも用意されていますが、mountコマンドからcifs共有としてマウントすることもできます。-t cifsと指定することで、mount.cifsコマンドが呼び出されます。もしmountコマンドで-t cifsを指定してもマウント出来ない場合には、moutn.cifsコマンドが正しくインストールされているかどうかの確認が必要でしょう。

[079]392.5 国際化
Sambaの文字コードについての解説で間違っているものを選びなさい。

a. Sambaの文字コード設定が主に影響するのはファイル名やフォルダ名である
b. Windows側とLinux側で異なる文字コードを扱うことができる
c. マッピングファイルを使うことでWindows側の日本語ユーザー名でSambaにアクセスすることができる
d. Sambaで日本語のコンピュータ名を扱うことはできない

答えは「d. Sambaで日本語のコンピュータ名を扱うことはできない」です。
Sambaは、Windowsクライアントに対してファイル共有を提供するため、日本語との関わりではファイル名やフォルダ名などに日本語を使う、という事が最も多いでしょう。
Linuxでも、ファイル名やディレクトリ名に日本語を使うことができますが、Windows側とLinux側でファイル名、ディレクトリ名に使用している日本語の文字コードが異なると、いわゆる「文字化け」してしまうことになります。

使用する文字コードは、それぞれWindows側、Linux側で設定することができます。異なる文字コードを指定した場合、両者の間で文字コードの変換を行うことになります。一般的なsmb.confでの設定は、以下の通りです。

○Sambaの文字コード設定
dos charset = CP932
unix charset = UTF-8

dos charsetがWindows側の文字コードでいわゆるSJIS、unix charsetがLinux側の設定で、新たしめのディストリビューションの場合、UTF-8が使用されることが多いでしょう。ターミナルでファイル操作を行う場合、環境変数LANGでの文字コード設定がUTF-8になっていれば、文字化けせずに日本語ファイル名を扱うことができます。

ユーザー名やグループ名は、LinuxではASCII文字によることなど制限がありますが、Windowsでは日本語のユーザー名、グループ名が許されています。マッピングファイル(username mapやgroupname map)を使うことで、Windows側の日本語ユーザー名を、Linux側のユーザー名に対応させることができます。同様に、コンピュータ名もマッピングファイルで対応させることができます。

文字コードの変換や対応付けは、思わぬ動作を起こす場合もありますので、極力日本語を使用しない運用にするか、事前に使用したい日本語文字列が正しく処理されるかテストしておくと良いでしょう。

[080]392.4 Sambaのトラブルシューティング
Sambaの簡易データベース(TDB)についての解説で間違っているものを選びなさい。

a. TDBにはSambaの各種設定が格納されている
b. TDBはkey-value型のデータベースとして値を保持している
c. TDBは目的に応じて複数のTDBファイルに分かれている
d. TDBファイルは自動的にバックアップされるので、バックアップディレクトリを確保する

答えは「d. TDBファイルは自動的にバックアップされるので、バックアップディレクトリを確保する」です。
Sambaの設定ファイルはsmb.confですが、動作中の設定情報を格納するための領域として簡易データベース（TDB Tiny DB）をバックエンドで利用しています。TDBは、内部的にはいわゆるkey-value型のデータベース構造をしているため、非常にシンプルに値を保持しています。そのため、目的に応じて別々のTDBファイルを用意して、格納するデータの種類によってファイルを用意するようになっています。
TDBファイルの内部に格納する値は、高速に処理が行えるようバイナリーとして扱われているので、そのまま編集などは行うことができません。別途、TDBを扱うためのコマンドが用意されているのはそのためです。以下のようなコマンドが用意されています。

・tdbdump
TDBファイルの中身をダンプします。ただし、基本的にはバイナリーデータを可読状態に変換しただけの出力のため、あまり一般的な用はなさないでしょう。

・tdbbackup
TDBファイルをバックアップします。TDBファイル破損時の復元はSambaが自動的に行うので、tdbrestoreコマンドは存在しません。

・tdbtool
TDBファイルを操作するコマンドです。このコマンドも一般的な用途では使用しないでしょう。

実用上では、しっかりと把握しておくべきはtdbbackupコマンドでしょう。
tdbbackupコマンドはSamba実行中でも実行することができるので、cron等で定期的に実行するよう、設定しておくとよいでしょう。

[081]392.3 Sambaの保守
Sambaの保守についての解説で間違っているものを選びなさい。

1. smbstatusコマンドを実行することで、Sambaの各種状態を取得できる
2. smbcontrolコマンドを実行することで、Sambaに対して様々な指示が送れる
3. tdbbackupコマンドを実行することで、Sambaが使用しているTDBのバックアップが行える
4. tdbbackupコマンドはSambaが停止している時に実行する必要がある

答えは「d. tdbbackupコマンドはSambaが停止している時に実行する必要がある」です。
Sambaはsmbdやnmbdなどのデーモンプロセスとして動作しているため、運用管理者はそれらのプロセスに対して保守用のコマンドを実行して、状態を取得したり、様々な指示を送ることができます。
smbstatusコマンドを実行すると、Sambaに対するクライアントの接続状況などを確認することができます。

smbcontrolコマンドを実行すると、Sambaに対して、接続を切断させたり、マスターブラウザの選定を実行させたりといった処理を運用管理者が意図的に実行させることができます。

tdbbackupコマンドは、Sambaが動作中に様々な情報を格納しておくTDB(Tiny DB)のバックアップを行うことができます。TDBが破損して整合性が取れなくなると最悪Sambaが動作しなくなるため、TDBをバックエンドにしてSambaを運用する場合にはtdbbackupコマンドを使って、定期的にTDBをバックアップする必要があります。

tdbbackupコマンドの実行は、Sambaの実行中にいつでも行えます。
tdbbackupコマンドに-vオプションをつけて実行すると、TDBの整合性を確認し、破損などがあった場合にはバックアップから復元を行います。

[082]392.2 Sambaを設定する
smb.confについての解説で間違っているものを選びなさい。

a. smb.confには全体設定のほか、ファイル、プリンタの共有を記述する
b. Samba全体の設定はすべて[global]セクションに設定する
c. プリンタ共有は[printers]またはプリンタ名のセクションに設定する
d. ファイル共有はすべて[shares]セクションに設定する

答えは「d. ファイル共有はすべて[shares]セクションに設定する」です。
Sambaの各種設定は、smb.confに記述していきます。smb.confでの設定の構造は概ね以下のようになっています。
○smb.confの構造例
[global] ＃全体設定をするセクション
    設定項目 = 設定値

[homes] ＃ユーザーのホームディレクトリを共有させる特殊なセクション
    設定項目 = 設定値

[ファイル共有名] ＃ファイル共有を設定するセクション
    設定項目 = 設定値
 
[ファイル共有名] ＃ファイル共有を設定するセクション

・・・

[printers] ＃Sambaが動作するLinux上のプリンタが共有される
    設定項目 = 設定値
    printable = yes

[プリンタ名] ＃プリンタ共有を個別に設定したい場合
    設定項目 = 設定値
    printable = yes

このようにセクションで区切って記述していくので、ファイル共有を複数作成する場合には、その分だけファイル共有セクションを追加する必要があります。Sambaは設定項目が多岐に渡るため、どのセクションに設定するのかはsmb.confのマニュアルに指定が記述されているので参考にすると良いでしょう。ただし、一部の設定項目はいずれのセクションにも記述できるようになっています。

[083]392.1 Sambaの概念とアーキテクチャ
Sambaのプロセスについての解説で間違っているものを選びなさい。

a. smbdはファイル共有を行うデーモンである
b. nmbdは名前解決を行うデーモンである
c. winbinddはSambaをドメインコントローラーとして動作させるデーモンである
d. Samba 4のAD DCではsambaプロセスが動作する

答えは「c. winbinddはSambaをドメインコントローラーとして動作させるデーモンである」です。
Samba 3では、複数のプロセスで動作するようになっています。ファイル共有をsmbd、名前解決をnmbd、Windowsのユーザー認証システムと統合するのがwinbinddです。この仕組みは、Samba 4になっても引き継がれています。
しかし、Samba 4でActive Directoryのドメインコントローラーとしての動作をサポートし、さらにDNSやLDAPの機能やKerberos認証の仕組みなどを統合するようになったことで、プロセスモデルも変更され、sambaプロセスのみが動作するように変わりました。

一方で、単純なファイルサーバーとして動作させる場合にはSamba 4でもsmbdなどのデーモンプロセスが動作するので、動作状況をよく把握しておき、トラブルシューティングに備えておく必要があるでしょう。

Samba 4についての情報はまだ少ないですが、以下のリンクが参考になります。

[084]391.2 アクティブディレクトリおよびKerberosとLDAPの統合
LDAPとActive Directoryの統合についての説明で間違っているものを選びなさい。

a. Active DirectoryのKerberos認証を使って、Linuxを認証できる
b. Kerberos認証はシングル・サインオンを実現する認証の仕組みである
c. シングル・サインオンは1回の認証で複数サービスの認証が行える
d. LinuxはActive Directoryのドメインには参加できない

答えは「d. LinuxはActive Directoryのドメインには参加できない」です。
Windows上で動作するActive Directoryは、LDAPによるディレクトリやKerberos認証などをサポートしています。
Kerberos認証は、いわゆるシングル・サインオンを実現する仕組みです。
Kerberosで一度認証が行われるとチケット(TGT)が発行され、以後はKerberos認証で連携しているサービスの認証はチケットを介して行われるようになります。サービス認証自体はバックエンドで行われているため、ユーザーからは認証を1回だけ行っているように見えるのでシングル・サインオンと呼ばれています。

LinuxをActive DirectoryのKerberos認証に接続することで、Linuxへのログイン認証などをActive Directoryの認証情報で行うことができます。認証にはPAMのpam_krb5モジュールを使用しますが、認証のみ行うため、ユーザーは別途Linux上で作成しておく必要があります。

Linux上でSambaを動かすことで、Active Directoryのドメインに参加することができます。この場合も、SambaへのアクセスをActive Directoryで認証することができます。

[085]391.1 PAMおよびNSSとLDAPの統合
LDAPとNSS、PAMの統合についての解説で間違っているものを選びなさい。

a. /etc/nsswitch.confを設定することでLDAPを参照するように設定できる
b. LDAPとPAMの統合にはpam_ldapを利用する
c. LDAPでの認証を行うには/etc/shadowにもユーザーを記述する必要がある
d. LDAPに格納されたパスワードをpasswdコマンドで変更できる

答えは「c. LDAPでの認証を行うには/etc/shadowにもユーザーを記述する必要がある」です。
OpenLDAPをNSS(Name Service Switch)、PAMと連携させるには、以下のような設定を行う必要があります。
まず、/etc/nsswitch.confに、以下のような記述を行います。

○/etc/nsswitch.confの例（抜粋）
passwd:     files ldap
shadow:     files ldap
group:      files ldap

protocols:  files ldap
services:   files ldap
netgroup:   files ldap
automount:  files ldap

この設定により、各種情報をLDAPから取得するようになります。
また、PAMとの認証統合には、たとえば/etc/pam.d/system-authを以下のように設定します。

○/etc/pam.d/system-authの例
auth        required      /lib/security/$ISA/pam_env.so
auth        sufficient    /lib/security/$ISA/pam_unix.so likeauth nullok
auth        sufficient    /lib/security/$ISA/pam_ldap.so use_first_pass
auth        required      /lib/security/$ISA/pam_deny.so

account     required      /lib/security/$ISA/pam_unix.so broken_shadow
account     sufficient    /lib/security/$ISA/pam_succeed_if.so uid < 100 quiet
account     [default=bad success=ok user_unknown=ignore] /lib/security/$ISA/pam_ldap.so
account     required      /lib/security/$ISA/pam_permit.so

password    requisite     /lib/security/$ISA/pam_cracklib.so retry=3
password    sufficient    /lib/security/$ISA/pam_unix.so nullok use_authtok md5 shadow
password    sufficient    /lib/security/$ISA/pam_ldap.so use_authtok
password    required      /lib/security/$ISA/pam_deny.so

session     required      /lib/security/$ISA/pam_limits.so
session     required      /lib/security/$ISA/pam_unix.so
session     optional      /lib/security/$ISA/pam_ldap.so

3行目のpam_ldapの記述で、認証を行っています。use_first_passは、ユーザーが最初に入力したパスワードをそのまま利用できる設定です。

7行目のpam_ldapの記述で、アカウントのチェックを行っています。
broken_shadowオプションをつけることで、/etc/shadowにアカウント情報が無くても無視します（エラーにならない）。

11行目のpam_ldapの記述で、passwdコマンドによるLDAPに対するパスワード変更を設定しています。

[086]390.3 OpenLDAPサーバのパフォーマンスチューニング
OpenLDAPのパフォーマンスの説明として間違っているものを選びなさい。

a. インデックスを作成することでLDAPの情報を更新する速度が速くなる
b. インデックスの作成はslapd.confに設定し、slapindexコマンドを実行する
c. DB_CONFIGの設定で、バックエンドDBの動作をチューニングできる
d. メモリ割り当てを増やすことでOpenLDAPの高速化が行える

答えは「a. インデックスを作成することでLDAPの情報を更新する速度が速くなる」です。
OpenLDAPの情報は、利用する際にはツリー型データベースですが、実際にはバックエンドのDBにBerkley DBが標準的に使用されています。OpenLDAPのパフォーマンスは、ツリー型のデータベースとしての性能を向上させることと、バックエンドDBの性能を向上させることの、2つの側面があります。
ツリー型データベースのアクセスは、ツリー構造の頂点（ルート）から、1つずつ分岐を辿っていくことで必要なデータにアクセスできます。ちょうどファイルのディレクトリ構造と一緒です。そのため、分岐の数が多かったり、階層が深くなるとそれだけ性能が劣化する要因になります。そこで、ユーザーアカウントなど頻繁にアクセスされる階層内の情報をリスト化しておき、直接参照できるようにしておくことで検索性能を向上させるのが、インデックスの基本的な考え方です。

インデックスを作成したい属性をslapd.confで指定し、slapindexコマンドを実行することで、その属性を元にしたLDAPへの検索性能が向上します。

バックエンドDBのアクセスは、そのDBの情報をファイルではなくメモリ上に配置することで、より高速なアクセスが可能になるようにするのが基本的な考え方です。そのため、バックエンドDBに対するメモリ割り当てを設定するDB_CONFIGに対して、読み込みや書き込みのためのバッファ容量を指定して、できるだけディスクに対するアクセスを少なくし、効率良く読み書きできるようにする必要があります。

[087]390.2 ディレクトリの保護
OpenLDAPのセキュリティの説明として間違っているものを選びなさい。

a. LDAPには認証に関する情報が含まれるので、暗号化を行う必要がある
b. LDAP通信の暗号化にはSSL/TLSを使った暗号化が利用できる
c. LDAP通信の接続を保護するためにダイジェスト認証が使用できる
d. LDAP通信を可能とするにはファイアーウォールの設定でポート389のみ通信可能に設定する

答えは「d. LDAP通信を可能とするにはファイアーウォールの設定でポート389のみ通信可能に設定する」です。
OpenLDAPは認証に関わる情報を格納しているので、環境によってはアクセス時の認証や通信の暗号化などを行って情報を保護する必要があります。
接続時の認証は、クライアントからのアクセスの場合とレプリケーションの場合とがありますが、MD5などを使用したダイジェスト認証の方式でアクセス許可を行うことができます。ただし、あくまで匿名での接続を排除するだけなので、LDAP通信の内容は平文でやり取りされ、通信を傍受されてしまえば情報が漏洩してしまう可能性があります。

通信経路の安全性を確保できない場合には、SSL/TLSを使った通信の暗号化が行えます。設定としてはHTTPをSSLで暗号化する場合と同様に、CAの公開鍵や証明書などの設定が必要となります。HTTPとHTTPSがポートが分かれているのと同様、LDAPとLDAP over SSL/TLS(LDAPS)はポート番号が異なるので、LDAPのポート389だけでなく、必要に応じてLDAPSのポート636もファイアーウォールの設定で通信可能にする必要があるでしょう。

[088]390.1 OpenLDAPのレプリケーション
OpenLDAPのレプリケーションの説明として間違っているものを選びなさい。

a. マスター・スレーブ方式では、マスターへの変更がスレーブに適用される
b. マスター・スレーブ方式では、スレーブに対する更新要求はエラーになる
c. マルチマスター方式では、一方への更新が他方に反映される
d. マルチマスター方式では、処理性能に合わせて負荷が自動的に分散される

答えは「d. マルチマスター方式では、処理性能に合わせて負荷が自動的に分散される」です。
OpenLDAPサーバーには認証などの重要な情報を格納するため、複数台のOpenLDAPサーバーを用意し、情報のレプリケーションをすることで、情報の冗長性を高めます。レプリケーションにはいくつかの方式があります。
●マスター・スレーブ方式は、一番基本的なレプリケーションの方式です。マスターサーバーへの情報の更新は、スレーブサーバーに伝播し、情報が同一になるように動作します。ただし、スレーブサーバーへの更新はエラーになるため、マスターサーバーが障害を起こしている間は情報の更新が行えません。
●マルチマスター方式は、複数のOpenLDAPサーバーの間で情報のレプリケーションをするのは、マスター・スレーブ方式と同様ですが、どちらのOpenLDAPサーバーに対しても更新処理が行える点が異なります。そのため、一方が障害を起こしても、更新処理を継続することができます。

ただし、マルチマスター方式でも複数のマスターサーバーで同時に更新を行うと、更新の競合が発生してしまったり、不整合が発生することがあります。そのため、運用上は一方のマスターサーバーにだけ更新処理を行わせ、もう一方は検索処理のみを受け付けるように構成します。構成には、ロードバランサーを利用することができます。

